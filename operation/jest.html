<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>jest base | NorthUnicorn</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.eab45adb.css" as="style"><link rel="preload" href="/assets/js/app.2d5a21ba.js" as="script"><link rel="preload" href="/assets/js/77.777397ae.js" as="script"><link rel="prefetch" href="/assets/js/10.8a362e98.js"><link rel="prefetch" href="/assets/js/11.d74a0997.js"><link rel="prefetch" href="/assets/js/12.e2a162e2.js"><link rel="prefetch" href="/assets/js/13.84c6fa39.js"><link rel="prefetch" href="/assets/js/14.c4eac9aa.js"><link rel="prefetch" href="/assets/js/15.6e106e89.js"><link rel="prefetch" href="/assets/js/16.9e29e9f1.js"><link rel="prefetch" href="/assets/js/17.9b3a8933.js"><link rel="prefetch" href="/assets/js/18.f0190824.js"><link rel="prefetch" href="/assets/js/19.9e8ce3c8.js"><link rel="prefetch" href="/assets/js/2.39847600.js"><link rel="prefetch" href="/assets/js/20.f1e6b579.js"><link rel="prefetch" href="/assets/js/21.f06a428f.js"><link rel="prefetch" href="/assets/js/22.e8fff36c.js"><link rel="prefetch" href="/assets/js/23.9be9c45e.js"><link rel="prefetch" href="/assets/js/24.b1a2e86a.js"><link rel="prefetch" href="/assets/js/25.2721ff74.js"><link rel="prefetch" href="/assets/js/26.2cca1f22.js"><link rel="prefetch" href="/assets/js/27.60ac312a.js"><link rel="prefetch" href="/assets/js/28.a51bcc0b.js"><link rel="prefetch" href="/assets/js/29.d4d7922b.js"><link rel="prefetch" href="/assets/js/3.e8366ca8.js"><link rel="prefetch" href="/assets/js/30.284529e8.js"><link rel="prefetch" href="/assets/js/31.329482e5.js"><link rel="prefetch" href="/assets/js/32.1dd41dba.js"><link rel="prefetch" href="/assets/js/33.cdaf88aa.js"><link rel="prefetch" href="/assets/js/34.d2260297.js"><link rel="prefetch" href="/assets/js/35.0f100cdc.js"><link rel="prefetch" href="/assets/js/36.2d7b8183.js"><link rel="prefetch" href="/assets/js/37.58e42fab.js"><link rel="prefetch" href="/assets/js/38.b702c8f5.js"><link rel="prefetch" href="/assets/js/39.82cf90ef.js"><link rel="prefetch" href="/assets/js/4.f13a62f3.js"><link rel="prefetch" href="/assets/js/40.5e523f7a.js"><link rel="prefetch" href="/assets/js/41.bdd3935e.js"><link rel="prefetch" href="/assets/js/42.38f97d1a.js"><link rel="prefetch" href="/assets/js/43.fde099dd.js"><link rel="prefetch" href="/assets/js/44.1c37dd97.js"><link rel="prefetch" href="/assets/js/45.98b02b2e.js"><link rel="prefetch" href="/assets/js/46.42f3fcd7.js"><link rel="prefetch" href="/assets/js/47.e82a83b5.js"><link rel="prefetch" href="/assets/js/48.198aa16b.js"><link rel="prefetch" href="/assets/js/49.584f6640.js"><link rel="prefetch" href="/assets/js/5.1ee23f75.js"><link rel="prefetch" href="/assets/js/50.8b31f4da.js"><link rel="prefetch" href="/assets/js/51.78f5d0ad.js"><link rel="prefetch" href="/assets/js/52.31174a6a.js"><link rel="prefetch" href="/assets/js/53.077bd356.js"><link rel="prefetch" href="/assets/js/54.3de7f928.js"><link rel="prefetch" href="/assets/js/55.3ad4df39.js"><link rel="prefetch" href="/assets/js/56.785eabef.js"><link rel="prefetch" href="/assets/js/57.8b4691e9.js"><link rel="prefetch" href="/assets/js/58.f7997b54.js"><link rel="prefetch" href="/assets/js/59.d7a4d8a8.js"><link rel="prefetch" href="/assets/js/6.705f6278.js"><link rel="prefetch" href="/assets/js/60.ddb9f94c.js"><link rel="prefetch" href="/assets/js/61.26981a47.js"><link rel="prefetch" href="/assets/js/62.3f032d2a.js"><link rel="prefetch" href="/assets/js/63.39527714.js"><link rel="prefetch" href="/assets/js/64.8868dd89.js"><link rel="prefetch" href="/assets/js/65.6b974d81.js"><link rel="prefetch" href="/assets/js/66.855c5823.js"><link rel="prefetch" href="/assets/js/67.31e1762e.js"><link rel="prefetch" href="/assets/js/68.8c46b6ac.js"><link rel="prefetch" href="/assets/js/69.86ace7af.js"><link rel="prefetch" href="/assets/js/7.1fd1c381.js"><link rel="prefetch" href="/assets/js/70.351ae70a.js"><link rel="prefetch" href="/assets/js/71.1d26e844.js"><link rel="prefetch" href="/assets/js/72.1df64755.js"><link rel="prefetch" href="/assets/js/73.090c6271.js"><link rel="prefetch" href="/assets/js/74.5788c180.js"><link rel="prefetch" href="/assets/js/75.74f8c6f5.js"><link rel="prefetch" href="/assets/js/76.7e7562cd.js"><link rel="prefetch" href="/assets/js/78.d7cc5ce5.js"><link rel="prefetch" href="/assets/js/79.d294b892.js"><link rel="prefetch" href="/assets/js/8.60fbcf9b.js"><link rel="prefetch" href="/assets/js/80.99fd18d4.js"><link rel="prefetch" href="/assets/js/81.2c0e2273.js"><link rel="prefetch" href="/assets/js/9.c9c66d36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eab45adb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NorthUnicorn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front/" class="nav-link">前端</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">后端</a></div><div class="nav-item"><a href="/operation/" class="nav-link router-link-active">operation</a></div><div class="nav-item"><a href="/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/article/" class="nav-link">article</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front/" class="nav-link">前端</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">后端</a></div><div class="nav-item"><a href="/operation/" class="nav-link router-link-active">operation</a></div><div class="nav-item"><a href="/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/article/" class="nav-link">article</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>operation</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/operation/git.html" class="sidebar-link">git</a></li><li><a href="/operation/nginx.html" class="sidebar-link">nginx</a></li><li><a href="/operation/linux.html" class="sidebar-link">linux</a></li><li><a href="/operation/docker.html" class="sidebar-link">docker</a></li><li><a href="/operation/jenkins.html" class="sidebar-link">jenkins</a></li><li><a href="/operation/vscode.html" class="sidebar-link">vscode</a></li><li><a href="/operation/jest.html" class="active sidebar-link">jest base</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/operation/jest.html#配置" class="sidebar-link">配置</a></li><li class="sidebar-sub-header"><a href="/operation/jest.html#jest-命令行" class="sidebar-link">jest 命令行</a></li><li class="sidebar-sub-header"><a href="/operation/jest.html#base" class="sidebar-link">base</a></li><li class="sidebar-sub-header"><a href="/operation/jest.html#mock" class="sidebar-link">mock</a></li><li class="sidebar-sub-header"><a href="/operation/jest.html#处理异步" class="sidebar-link">处理异步</a></li><li class="sidebar-sub-header"><a href="/operation/jest.html#class" class="sidebar-link">class</a></li><li class="sidebar-sub-header"><a href="/operation/jest.html#snapshot-快照" class="sidebar-link">snapshot 快照</a></li><li class="sidebar-sub-header"><a href="/operation/jest.html#vue-test" class="sidebar-link">vue test</a></li></ul></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="jest-base"><a href="#jest-base" aria-hidden="true" class="header-anchor">#</a> jest base</h1> <p></p><div class="table-of-contents"><ul><li><a href="#配置">配置</a><ul><li><a href="#jest-配置">jest 配置</a></li><li><a href="#babel-配置">babel 配置</a></li><li><a href="#vscode-配置">vscode 配置</a></li><li><a href="#脚本-配置">脚本 配置</a></li></ul></li><li><a href="#jest-命令行">jest 命令行</a></li><li><a href="#base">base</a><ul><li><a href="#基本结构">基本结构</a></li><li><a href="#生命周期">生命周期</a></li><li><a href="#断言">断言</a></li></ul></li><li><a href="#mock">mock</a><ul><li><a href="#测试接口的小例子">测试接口的小例子</a></li><li><a href="#函数处理">函数处理</a></li></ul></li><li><a href="#处理异步">处理异步</a></li><li><a href="#class">class</a></li><li><a href="#snapshot-快照">snapshot 快照</a></li><li><a href="#vue-test">vue test</a><ul><li><a href="#试手">试手</a></li></ul></li></ul></div><p></p> <h2 id="配置"><a href="#配置" aria-hidden="true" class="header-anchor">#</a> 配置</h2> <h3 id="jest-配置"><a href="#jest-配置" aria-hidden="true" class="header-anchor">#</a> jest 配置</h3> <ul><li>安装 cnpm i -D jest</li> <li>配置文件 npx jest --init(npx 调用的是node_modules下的jest)</li> <li>npx jest --coverage 生成测试覆盖率(或者脚本配置 jest coverage)</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// true时，当前引入文件时候 首先会到__mocks__ 目录下查找,在到当前文件下查找</span>
  automock<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 每次清空 每次的mock数据</span>
  clearMocks<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token comment">// 当测试覆盖率的文件 名字</span>
  coverageDirectory<span class="token punctuation">:</span> <span class="token string">&quot;coverage&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 要测试文件的位子</span>
  testMatch<span class="token punctuation">:</span> <span class="token punctuation">[</span>
    <span class="token string">'**/tests/**/*.(js|jsx|tsx)'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="babel-配置"><a href="#babel-配置" aria-hidden="true" class="header-anchor">#</a> babel 配置</h3> <ul><li>jest 默认只认识 commonJs</li> <li>安装babel @babel/core@7.4.5 @babel/preset-env@7.4.5</li> <li>创建.babelrc文件</li> <li>jest 内部有一个(babel-jest)插件 他会去找babelrc的配置</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
  <span class="token string">&quot;presets&quot;</span><span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">[</span><span class="token string">&quot;@babel/preset-env&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token string">&quot;targets&quot;</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token string">&quot;node&quot;</span><span class="token punctuation">:</span><span class="token string">&quot;current&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">]</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="vscode-配置"><a href="#vscode-配置" aria-hidden="true" class="header-anchor">#</a> vscode 配置</h3> <ul><li>vscode jest  不用跑脚本了</li></ul> <h3 id="脚本-配置"><a href="#脚本-配置" aria-hidden="true" class="header-anchor">#</a> 脚本 配置</h3> <ul><li>package.json =&gt; jest --watch 配置后 没有o模式 自带，</li> <li>package.json =&gt; jest --watchAll 配置后 有o模式 有a模式，</li></ul> <h2 id="jest-命令行"><a href="#jest-命令行" aria-hidden="true" class="header-anchor">#</a> jest 命令行</h2> <ul><li>w切换模式</li> <li>f模式 过滤没有通过的测试 再次按f即退出这个模式</li> <li>0模式 只测试修改过的文件 但是需要git commit 配合  (git commit 提交后  只会测试修改后的文件)</li> <li>a模式 跑一遍所有的测试</li> <li>p模式 通过filename 进行过滤</li> <li>t模式 通过test用例的名字 进行过滤</li> <li>q模式 就是退出</li> <li>Enter模式 重新跑</li></ul> <h2 id="base"><a href="#base" aria-hidden="true" class="header-anchor">#</a> base</h2> <h3 id="基本结构"><a href="#基本结构" aria-hidden="true" class="header-anchor">#</a> 基本结构</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'目录'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">//....生命周期</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'多层目录'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">//....生命周期</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'单个测试1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'单个测试2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h3 id="生命周期"><a href="#生命周期" aria-hidden="true" class="header-anchor">#</a> 生命周期</h3> <ul><li>beforeAll 他作用于所有的test 最新执行</li> <li>beforeEach 他作用于当个test 在每一个test前执行</li> <li>afterEach 他作用于当个test 在每一个test后执行</li> <li>afterAll 他作用于所有的test 每一个test执行完成后他在执行</li> <li>特例 describe&amp;&amp;test 里面的<code>console.log()</code>在生命周期之前执行</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">beforeAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">afterEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token function">afterAll</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>

  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="断言"><a href="#断言" aria-hidden="true" class="header-anchor">#</a> 断言</h3> <ul><li>匹配器
<ul><li>toBe 判断值是否相同:expect(1).toBe(1)  类似<code>===</code></li> <li>toEqual 判断对象的是否相等 expect({one:1}).toBe({one:1}) 并非比较引用地址,他会递归比较</li> <li>0.1+0.3 上面2个都不能处理 用toBeCloseTo处理</li></ul></li> <li>真假相关
<ul><li>toBeNull  <code>const a = null; expect(a).toBeNull()</code> 判断null</li> <li>toBeDefined  <code>const a = null; expect(a).toBeDefined()</code> 判断是否被定义</li> <li>toBeTruthy  <code>const a = 1; expect(a).toBeTruthy()</code> 判断为true</li> <li>toBeFalsy  <code>const a = 0; expect(a).toBeFalsy()</code> 判断为false</li> <li>not  <code>const a = 1; expect(a).not.toBeFalsy()</code> 取反</li></ul></li> <li>数字相关的匹配器 大小
<ul><li>toBeGreaterThan <code>const a = 12; expect(a).toBeGreaterThan(11)</code> 大于</li> <li>toBeLessThan 小于</li> <li>toBeGreaterThanOrEqual 大于等于</li></ul></li> <li>字符串 匹配里面放正则
<ul><li>toMatch <code>const str = 'http://www.dell-le.com'; expect(str).toMatch(/www/)</code></li></ul></li> <li>Array Set
<ul><li>toContain <code>const arr = ['dell','lee','imooc'];const data = new Set(arr);expect(arr).toContain('dell'); expect(data).toContain('dell')</code></li></ul></li> <li>异常
<ul><li>toThrow 里面的值如果写的话要个报错保持一致 <code>const fn =()=&gt;{throw new Error('this is a new error')};expect(fn).toThrow('this is a new error')</code></li> <li>toThrow里面的参数可以是字符串 也可以是正则</li></ul></li> <li>对象
<ul><li>toMatchObject 对象包含</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token punctuation">{</span>
  a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
  b<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span>
<span class="token function">expect</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  b<span class="token punctuation">:</span><span class="token number">2</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 工具库</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name">Counter</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">=</span> <span class="token number">0</span>
  <span class="token punctuation">}</span>
  <span class="token function">addOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">+=</span><span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token function">addTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">+=</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
  <span class="token function">minusOne</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">-=</span><span class="token number">1</span>
  <span class="token punctuation">}</span>
  <span class="token function">minusTwo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>number <span class="token operator">-=</span> <span class="token number">2</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试 Counter 中的 addOne 方法'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  counter <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Counter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>counter<span class="token punctuation">.</span>number<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="mock"><a href="#mock" aria-hidden="true" class="header-anchor">#</a> mock</h2> <ul><li>mock 即模仿 当<code>jest.mock('./demo')</code> 之后的引用 <code>'./demo'</code>都会去__mocks__目录下查找文件,若没有在去当前目录下查找,就是对原文件进行了一个拦截,一般就是模拟处理我们的异步，<code>jest.mock('./xx')</code>他会默认提升位子 执行的时候会跑到import之前执行</li> <li><code>jest.unmock('./demo')</code>取消模拟</li> <li><code>const {fetchData} = jest.requireActual('./demo')</code> 即引入当前真正的文件</li> <li>作用
<ul><li>1、mock函数 捕获函数的调用和返回结果 以及this和执行顺序</li> <li>2、可以让我们自由的设置返回结果</li> <li>1、修改内部函数的实现</li></ul></li></ul> <h3 id="测试接口的小例子"><a href="#测试接口的小例子" aria-hidden="true" class="header-anchor">#</a> 测试接口的小例子</h3> <ul><li>only 表示只测试当前的一个test用例</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 真实例子</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span>rs<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// mock axios</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试 fetchData'</span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span>  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 拦截例子 不会等待真实接口发送请求  时间太长了</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolved<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">resolved</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// 测试 修改 jest.moc()里面的参数</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./demo'</span><span class="token punctuation">)</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> fetchData <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'./demo'</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span><span class="token string">'mock'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token string">&quot;123&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="函数处理"><a href="#函数处理" aria-hidden="true" class="header-anchor">#</a> 函数处理</h3> <ul><li>jest.fn 内置函数 捕获函数的调用 同时携带一些参数</li> <li>jest.fn().mock
<ul><li>calls 被执行 返回的参数和个数</li> <li>results 是jest.fn 里面的执行结果</li> <li>instances 在写类的时候 才有用 函数无效, 指的是当前this</li></ul></li> <li>mockImplementation/mockImplementationOnce,mockReturnValueOnce/mockReturnValue,都可以设置mock函数的返回值</li> <li>jest.mock('axios') 拦截axios请求</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">'axios'</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">runCallback</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">cb</span><span class="token punctuation">(</span><span class="token string">'123'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">createObject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
 <span class="token keyword">new</span> <span class="token class-name">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">getData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/api'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span> <span class="token operator">=&gt;</span> rs<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">return</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span>rs<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试函数被执行'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> func <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token number">123</span><span class="token punctuation">)</span>
  <span class="token function">runCallback</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>mock<span class="token punctuation">,</span><span class="token string">'里面保存了返回的参数以及mock函数返回的参数'</span><span class="token punctuation">)</span>
  <span class="token comment">// func.mock.calls.length</span>
  <span class="token comment">// func.mock.results[0].value</span>
  <span class="token comment">// 此函数被调用</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试 createObject'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> func <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">createObject</span><span class="token punctuation">(</span>func<span class="token punctuation">)</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>func<span class="token punctuation">.</span>mock<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 拦截axios请求</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'axios'</span><span class="token punctuation">)</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试 getData'</span><span class="token punctuation">,</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// 拦截axios真正的请求</span>
  <span class="token comment">// mockResolvedValueOnce 设置一次 </span>
  <span class="token comment">// mockResolvedValue 设置所有 </span>
  axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  axios<span class="token punctuation">.</span>get<span class="token punctuation">.</span><span class="token function">mockResolvedValueOnce</span><span class="token punctuation">(</span><span class="token punctuation">{</span>data<span class="token punctuation">:</span><span class="token string">'hello1'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">await</span> <span class="token function">getData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'hello1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="处理异步"><a href="#处理异步" aria-hidden="true" class="header-anchor">#</a> 处理异步</h2> <ul><li>回调函数用</li> <li>promise</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 回调</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">fn</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://www.dell-lee.com/react/api/demo.json'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">rs</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">fn</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>data<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">// promise</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://www.dell-lee.com/react/api/demo.json'</span><span class="token punctuation">)</span>
<span class="token comment">// 404</span>
<span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">fetchData</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> axios<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'http://www.dell-lee.com/react/api/demo1.json'</span><span class="token punctuation">)</span>

<span class="token comment">// test</span>
<span class="token comment">// 回调函数 必须要用到 done 函数执行 否则回调函数无法测试到</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'回调'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">done</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      success<span class="token punctuation">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token function">done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// promise</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`promise`</span></span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> rs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>rs<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    success<span class="token punctuation">:</span><span class="token boolean">true</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 或者用 下面的  但是一定要加return 否则没用</span>
  <span class="token comment">// return fetchData().then(rs=&gt;{</span>
  <span class="token comment">//   expect(rs.data).toEqual({</span>
  <span class="token comment">//     success:true</span>
  <span class="token comment">//   })</span>
  <span class="token comment">// })</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// 404 一般要单独测试</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`404`</span></span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// 下面的expect 要执行一次 如果返回成功的情况下 是不会走catch语句的 </span>
  expect<span class="token punctuation">.</span><span class="token function">assertions</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatch</span><span class="token punctuation">(</span><span class="token string">'404'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>


<span class="token comment">// promise异步 匹配对象</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`fetchData`</span></span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// toMatchObject 匹配对象</span>
  <span class="token comment">// expect(fetchData()).resolves ajax 返回的所有成功数据</span>
  <span class="token keyword">return</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>resolves<span class="token punctuation">.</span><span class="token function">toMatchObject</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    data<span class="token punctuation">:</span><span class="token punctuation">{</span>
      success<span class="token punctuation">:</span><span class="token boolean">true</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 404</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`fetchData`</span></span><span class="token punctuation">,</span><span class="token keyword">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// toMatchObject 匹配对象</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>rejects<span class="token punctuation">.</span><span class="token function">toThrow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><ul><li>定时器测试</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token parameter">cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

jest<span class="token punctuation">.</span><span class="token function">useFakeTimers</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'timer 测试'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> fn <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span>
  <span class="token function">timer</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 快进秒数 这个时间要大于异步函数执行的时间</span>
  jest<span class="token punctuation">.</span><span class="token function">advanceTimersByTime</span><span class="token punctuation">(</span><span class="token number">4000</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalledTimes</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="class"><a href="#class" aria-hidden="true" class="header-anchor">#</a> class</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// util </span>
<span class="token keyword">class</span> <span class="token class-name">Util</span> <span class="token punctuation">{</span>
  <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// .... 复杂</span>
  <span class="token punctuation">}</span> 
  <span class="token function">a</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// .... 复杂</span>
  <span class="token punctuation">}</span> 
  <span class="token function">b</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// .... 复杂</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> <span class="token function-variable function">demoFunction</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">a<span class="token punctuation">,</span>b</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> util <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Util</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  util<span class="token punctuation">.</span><span class="token function">a</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span>
  util<span class="token punctuation">.</span><span class="token function">b</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// __mocks__/util 拦截处理</span>
<span class="token keyword">const</span> Util <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a,b'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">Util</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>a <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a,b'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token class-name">Util</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>b <span class="token operator">=</span> jest<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'a,b'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> Util<span class="token punctuation">;</span>


<span class="token comment">// 默认提高 可以自定义类 在__mocks__ 下创建一个util</span>
jest<span class="token punctuation">.</span><span class="token function">mock</span><span class="token punctuation">(</span><span class="token string">'./util'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> Util <span class="token keyword">from</span> <span class="token string">'./util'</span><span class="token punctuation">;</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'测试类'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token function">domeFunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// class 被执行</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>Util<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// 内中的方法被执行</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>Util<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>a<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>Util<span class="token punctuation">.</span>mock<span class="token punctuation">.</span>instances<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>b<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="snapshot-快照"><a href="#snapshot-快照" aria-hidden="true" class="header-anchor">#</a> snapshot 快照</h2> <ul><li>处理config配置文件 当第一次保存的时候  会生成一个快照  之后只要修改config 都会提醒配置文件变更了</li> <li>安装 <code>prettier</code> 快照会在当前文件内打印下来 默认情况下 会单独生成配置文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">const</span> <span class="token function-variable function">generateConfig</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    server<span class="token punctuation">:</span><span class="token string">'http://localhost'</span><span class="token punctuation">,</span>
    port<span class="token punctuation">:</span><span class="token number">8080</span><span class="token punctuation">,</span>
    domain<span class="token punctuation">:</span><span class="token string">'localhost'</span><span class="token punctuation">,</span>
    time<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// test</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;snapshot config&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span><span class="token function">generateConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toMatchInlineSnapshot</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
      <span class="token comment">// 处理每次变化的数据 例如time</span>
      time<span class="token punctuation">:</span> expect<span class="token punctuation">.</span><span class="token function">any</span><span class="token punctuation">(</span>Date<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// toMatchSnapshot 监控配置项</span>
<span class="token comment">// 第一次的配置项保存起来 下次修改的时候  会提示报错</span>
<span class="token comment">// u 操作能清除报错</span>
<span class="token comment">// i 当多个快照存在的时候 i是分部处理</span>

<span class="token comment">// 如果一直变动的情况  比如Date</span>
<span class="token comment">/*
  可以写成
  toMatchSnapshot({
    // Date 这里写的是类型
    time:expect.any(Date)
  })
*/</span>
</code></pre></div><h2 id="vue-test"><a href="#vue-test" aria-hidden="true" class="header-anchor">#</a> vue test</h2> <ul><li>npm install --save-dev jsdom jsdom-global</li></ul> <h3 id="试手"><a href="#试手" aria-hidden="true" class="header-anchor">#</a> 试手</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Counter.vue</span>
    <span class="token operator">&lt;</span>input
      <span class="token punctuation">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;$style.headerInput&quot;</span>
        data<span class="token operator">-</span>test<span class="token operator">=</span><span class="token string">'input1'</span>
        v<span class="token operator">-</span>model<span class="token operator">=</span><span class="token string">'inputValue'</span>
        @keyup<span class="token punctuation">.</span>enter<span class="token operator">=</span><span class="token string">'addTodoItem'</span>
        placeholder<span class="token operator">=</span><span class="token string">&quot;TodoList!&quot;</span>
    <span class="token operator">/</span><span class="token operator">&gt;</span>
    <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
      <span class="token function">data</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
          inputValue<span class="token punctuation">:</span> <span class="token string">''</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      methods<span class="token punctuation">:</span> <span class="token punctuation">{</span>
        <span class="token function">addTodoItem</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'add'</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>inputValue <span class="token operator">=</span> <span class="token string">''</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// test</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> mount <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'@vue/test-utils'</span>
  <span class="token keyword">import</span> Counter <span class="token keyword">from</span> <span class="token string">'./counter'</span>
<span class="token comment">// 判断一个元素是否存在</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Counter'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 现在挂载组件，你便得到了这个包裹器</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span>
    <span class="token comment">// 也便于检查已存在的元素</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Counter 包含 input 框'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">'input'</span><span class="token punctuation">)</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">.</span><span class="token function">exists</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 获取 data内的数据</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Counter 中input的数据为空'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>inputValue
    <span class="token function">expect</span><span class="token punctuation">(</span>input<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// input 框值发生变化,数据应该跟着变</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Counter input 框值发生变化,数据应该跟着变'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span>
    <span class="token comment">// 如果是 findAll 就是所有的都设置</span>
    <span class="token keyword">const</span> input <span class="token operator">=</span> wrapper<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token string">&quot;[data-test='input']&quot;</span><span class="token punctuation">)</span>
    input<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// input 框输入回车,无内容时,无反应</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Header 中 input 框输入回车,无内容时,无反应'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">)</span>
  input<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
  input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keyup.enter'</span><span class="token punctuation">)</span>
  <span class="token comment">// 当数据为空 回撤的时候 事件不被触发</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 中 input 框输入回车,无内容时,无反应 </span>
  <span class="token comment">// trigger 第二个参数穿传入一个对象 他会混入 event参数中</span>
  <span class="token comment">// emitted 表示事件被触发 后面接收事件名</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Header 中 input 框输入回车,无内容时,无反应'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">)</span>
  <span class="token comment">// input.setValue('')</span>
  input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keyup.enter'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token number">11</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token comment">// 当数据为空 回撤的时候 事件不被触发</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeFalsy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// input 框输入回车,有内容时,向外触发事件,同时情况 inputValue</span>
<span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'Header 中 input 框输入回车,有内容时,向外触发事件,同时情况 inputValue'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> wrapper <span class="token operator">=</span> <span class="token function">shallowMount</span><span class="token punctuation">(</span>Header<span class="token punctuation">)</span>
  <span class="token keyword">const</span> input <span class="token operator">=</span> <span class="token function">findTestWrapper</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">,</span> <span class="token string">'input'</span><span class="token punctuation">)</span>
  input<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span><span class="token string">'dell lee'</span><span class="token punctuation">)</span>
  input<span class="token punctuation">.</span><span class="token function">trigger</span><span class="token punctuation">(</span><span class="token string">'keyup.enter'</span><span class="token punctuation">)</span>
  <span class="token comment">// 当有数据 回撤的时候 事件被触发 同时情况数据</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span><span class="token function">emitted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>add<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeTruthy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>wrapper<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>inputValue<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">9/16/2020, 7:44:40 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/operation/vscode.html" class="prev">
          vscode
        </a></span> <!----></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.2d5a21ba.js" defer></script><script src="/assets/js/77.777397ae.js" defer></script>
  </body>
</html>
