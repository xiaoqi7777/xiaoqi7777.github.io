<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>webpack | NorthUnicorn</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.eab45adb.css" as="style"><link rel="preload" href="/assets/js/app.2d5a21ba.js" as="script"><link rel="preload" href="/assets/js/47.e82a83b5.js" as="script"><link rel="prefetch" href="/assets/js/10.8a362e98.js"><link rel="prefetch" href="/assets/js/11.d74a0997.js"><link rel="prefetch" href="/assets/js/12.e2a162e2.js"><link rel="prefetch" href="/assets/js/13.84c6fa39.js"><link rel="prefetch" href="/assets/js/14.c4eac9aa.js"><link rel="prefetch" href="/assets/js/15.6e106e89.js"><link rel="prefetch" href="/assets/js/16.9e29e9f1.js"><link rel="prefetch" href="/assets/js/17.9b3a8933.js"><link rel="prefetch" href="/assets/js/18.f0190824.js"><link rel="prefetch" href="/assets/js/19.9e8ce3c8.js"><link rel="prefetch" href="/assets/js/2.39847600.js"><link rel="prefetch" href="/assets/js/20.f1e6b579.js"><link rel="prefetch" href="/assets/js/21.f06a428f.js"><link rel="prefetch" href="/assets/js/22.e8fff36c.js"><link rel="prefetch" href="/assets/js/23.9be9c45e.js"><link rel="prefetch" href="/assets/js/24.b1a2e86a.js"><link rel="prefetch" href="/assets/js/25.2721ff74.js"><link rel="prefetch" href="/assets/js/26.2cca1f22.js"><link rel="prefetch" href="/assets/js/27.60ac312a.js"><link rel="prefetch" href="/assets/js/28.a51bcc0b.js"><link rel="prefetch" href="/assets/js/29.d4d7922b.js"><link rel="prefetch" href="/assets/js/3.e8366ca8.js"><link rel="prefetch" href="/assets/js/30.284529e8.js"><link rel="prefetch" href="/assets/js/31.329482e5.js"><link rel="prefetch" href="/assets/js/32.1dd41dba.js"><link rel="prefetch" href="/assets/js/33.cdaf88aa.js"><link rel="prefetch" href="/assets/js/34.d2260297.js"><link rel="prefetch" href="/assets/js/35.0f100cdc.js"><link rel="prefetch" href="/assets/js/36.2d7b8183.js"><link rel="prefetch" href="/assets/js/37.58e42fab.js"><link rel="prefetch" href="/assets/js/38.b702c8f5.js"><link rel="prefetch" href="/assets/js/39.82cf90ef.js"><link rel="prefetch" href="/assets/js/4.f13a62f3.js"><link rel="prefetch" href="/assets/js/40.5e523f7a.js"><link rel="prefetch" href="/assets/js/41.bdd3935e.js"><link rel="prefetch" href="/assets/js/42.38f97d1a.js"><link rel="prefetch" href="/assets/js/43.fde099dd.js"><link rel="prefetch" href="/assets/js/44.1c37dd97.js"><link rel="prefetch" href="/assets/js/45.98b02b2e.js"><link rel="prefetch" href="/assets/js/46.42f3fcd7.js"><link rel="prefetch" href="/assets/js/48.198aa16b.js"><link rel="prefetch" href="/assets/js/49.584f6640.js"><link rel="prefetch" href="/assets/js/5.1ee23f75.js"><link rel="prefetch" href="/assets/js/50.8b31f4da.js"><link rel="prefetch" href="/assets/js/51.78f5d0ad.js"><link rel="prefetch" href="/assets/js/52.31174a6a.js"><link rel="prefetch" href="/assets/js/53.077bd356.js"><link rel="prefetch" href="/assets/js/54.3de7f928.js"><link rel="prefetch" href="/assets/js/55.3ad4df39.js"><link rel="prefetch" href="/assets/js/56.785eabef.js"><link rel="prefetch" href="/assets/js/57.8b4691e9.js"><link rel="prefetch" href="/assets/js/58.f7997b54.js"><link rel="prefetch" href="/assets/js/59.d7a4d8a8.js"><link rel="prefetch" href="/assets/js/6.705f6278.js"><link rel="prefetch" href="/assets/js/60.ddb9f94c.js"><link rel="prefetch" href="/assets/js/61.26981a47.js"><link rel="prefetch" href="/assets/js/62.3f032d2a.js"><link rel="prefetch" href="/assets/js/63.39527714.js"><link rel="prefetch" href="/assets/js/64.8868dd89.js"><link rel="prefetch" href="/assets/js/65.6b974d81.js"><link rel="prefetch" href="/assets/js/66.855c5823.js"><link rel="prefetch" href="/assets/js/67.31e1762e.js"><link rel="prefetch" href="/assets/js/68.8c46b6ac.js"><link rel="prefetch" href="/assets/js/69.86ace7af.js"><link rel="prefetch" href="/assets/js/7.1fd1c381.js"><link rel="prefetch" href="/assets/js/70.351ae70a.js"><link rel="prefetch" href="/assets/js/71.1d26e844.js"><link rel="prefetch" href="/assets/js/72.1df64755.js"><link rel="prefetch" href="/assets/js/73.090c6271.js"><link rel="prefetch" href="/assets/js/74.5788c180.js"><link rel="prefetch" href="/assets/js/75.74f8c6f5.js"><link rel="prefetch" href="/assets/js/76.7e7562cd.js"><link rel="prefetch" href="/assets/js/77.777397ae.js"><link rel="prefetch" href="/assets/js/78.d7cc5ce5.js"><link rel="prefetch" href="/assets/js/79.d294b892.js"><link rel="prefetch" href="/assets/js/8.60fbcf9b.js"><link rel="prefetch" href="/assets/js/80.99fd18d4.js"><link rel="prefetch" href="/assets/js/81.2c0e2273.js"><link rel="prefetch" href="/assets/js/9.c9c66d36.js">
    <link rel="stylesheet" href="/assets/css/0.styles.eab45adb.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NorthUnicorn</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/front/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">后端</a></div><div class="nav-item"><a href="/operation/" class="nav-link">operation</a></div><div class="nav-item"><a href="/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/article/" class="nav-link">article</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/front/" class="nav-link router-link-active">前端</a></div><div class="nav-item"><a href="/houduan/" class="nav-link">后端</a></div><div class="nav-item"><a href="/operation/" class="nav-link">operation</a></div><div class="nav-item"><a href="/interview/" class="nav-link">interview</a></div><div class="nav-item"><a href="/article/" class="nav-link">article</a></div><div class="nav-item"><a href="https://github.com/xiaoqi7777" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/about/" class="nav-link">about</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>front</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/front/css.html" class="sidebar-link">css技巧汇总</a></li><li><a href="/front/js.html" class="sidebar-link">js</a></li><li><a href="/front/react.html" class="sidebar-link">react 汇总</a></li><li><a href="/front/vue.html" class="sidebar-link">vue 汇总</a></li><li><a href="/front/vuepress.html" class="sidebar-link">vuepress</a></li><li><a href="/front/phone.html" class="sidebar-link">移动端</a></li><li><a href="/front/webpack.html" class="active sidebar-link">webpack</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/front/webpack.html#手动配置" class="sidebar-link">手动配置</a></li><li class="sidebar-sub-header"><a href="/front/webpack.html#高级配置" class="sidebar-link">高级配置</a></li><li class="sidebar-sub-header"><a href="/front/webpack.html#优化" class="sidebar-link">优化</a></li><li class="sidebar-sub-header"><a href="/front/webpack.html#tapable" class="sidebar-link">tapable</a></li><li class="sidebar-sub-header"><a href="/front/webpack.html#resolveloader解析loader路径的" class="sidebar-link">resolveLoader解析loader路径的</a></li><li class="sidebar-sub-header"><a href="/front/webpack.html#手写webapck" class="sidebar-link">手写webapck</a></li><li class="sidebar-sub-header"><a href="/front/webpack.html#手写loader" class="sidebar-link">手写loader</a></li><li class="sidebar-sub-header"><a href="/front/webpack.html#webpack-流程" class="sidebar-link">webpack 流程</a></li><li class="sidebar-sub-header"><a href="/front/webpack.html#手写plugin" class="sidebar-link">手写plugin</a></li></ul></li><li><a href="/front/video.html" class="sidebar-link">视频</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>js</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/front/jsBase.html" class="sidebar-link">js基础</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="webpack"><a href="#webpack" aria-hidden="true" class="header-anchor">#</a> webpack</h1> <p></p><div class="table-of-contents"><ul><li><a href="#手动配置">手动配置</a><ul><li><a href="#css处理">css处理</a></li><li><a href="#js">js</a></li><li><a href="#jquery-全局问题">jquery&amp;&amp;全局问题</a></li><li><a href="#图片处理">图片处理</a></li><li><a href="#文件分类打包">文件分类打包</a></li></ul></li><li><a href="#高级配置">高级配置</a><ul><li><a href="#多页配置">多页配置</a></li><li><a href="#source-map">source-map</a></li><li><a href="#watch-监控打包">watch&amp;&amp;监控打包</a></li><li><a href="#小插件">小插件</a></li><li><a href="#跨域">跨域</a></li><li><a href="#resolve-解析">resolve&amp;&amp;解析</a></li><li><a href="#环境变量">环境变量</a></li><li><a href="#区分不用环境-合并webpack">区分不用环境&amp;&amp;合并webpack</a></li></ul></li><li><a href="#优化">优化</a><ul><li><a href="#动态连接库">动态连接库</a></li><li><a href="#多线程打包">多线程打包</a></li><li><a href="#webpack自带优化">webpack自带优化</a></li><li><a href="#抽离公共代码">抽离公共代码</a></li><li><a href="#懒加载">懒加载</a></li><li><a href="#热更新">热更新</a></li></ul></li><li><a href="#tapable">tapable</a></li><li><a href="#resolveloader解析loader路径的">resolveLoader解析loader路径的</a></li><li><a href="#手写webapck">手写webapck</a></li><li><a href="#手写loader">手写loader</a></li><li><a href="#webpack-流程">webpack 流程</a></li><li><a href="#手写plugin">手写plugin</a></li></ul></div><p></p> <ul><li>安装
<ul><li>yarn add webpack webpack-cli -D(webpack 必安装的2个)</li> <li>webpack可以进行0配置(npx webpack  默认会打包下文件src)</li></ul></li></ul> <h2 id="手动配置"><a href="#手动配置" aria-hidden="true" class="header-anchor">#</a> 手动配置</h2> <ul><li>创建webpack.config.js(文件名字默认的)</li> <li>如果要修改webpack.config.js名字 就只能通过 pack.json
<ul><li>打包 &quot;build&quot;:&quot;webpack --config webpack.config.xxx.js&quot;</li> <li>开启静态服务 &quot;dev&quot;: &quot;webpack-dev-server&quot;</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token comment">//生成html插件</span>
<span class="token keyword">let</span> HTMLWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  devServer<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">// 开发服务器的配置 默认8080</span>
    port<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token comment">// 端口</span>
    open<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 直接在浏览器打开</span>
    progress<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 开启进度条</span>
    contentBase<span class="token punctuation">:</span><span class="token string">'./dist'</span><span class="token punctuation">,</span><span class="token comment">//开启服务 指定路径</span>
    compress<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token comment">//压缩</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  mode<span class="token punctuation">:</span><span class="token string">&quot;development&quot;</span><span class="token punctuation">,</span><span class="token comment">//模式 production development</span>
  entry<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">//ss 入口的名字</span>
    ss<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'src/index.js'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment">//入口</span>
  output<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">//打包后的文件名 [name]指向 entry的ss 若只有路径 默认是main [hash:8] 后面会带一串字符 :8 长度是8  </span>
    filename<span class="token punctuation">:</span><span class="token string">'[name].[hash:8].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//路径必须是一个绝对路径</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token comment">//数组放着所有的webpack插件</span>
    <span class="token keyword">new</span> <span class="token class-name">HTMLWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span><span class="token string">'./src/index.html'</span><span class="token punctuation">,</span> <span class="token comment">//模板 路径</span>
      filename<span class="token punctuation">:</span><span class="token string">'index.html'</span><span class="token punctuation">,</span> <span class="token comment">// 生成的文件名字</span>
      minify<span class="token punctuation">:</span><span class="token punctuation">{</span>
        removeAttributeQuotes<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 删除html &quot;&quot;</span>
        collapseWhitespace<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 生成一行</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      hash<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">//引入的文件生成hash</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">// 模块</span>
    rules<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token comment">//规则</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// css-loader 主要解析 @import这类语法的</span>
        <span class="token comment">// style-loader 他是把css  插入到head的标签底部</span>
        <span class="token comment">// loader用法  一个用字符串 多个用[],顺序默认从右向左执行,从下向上</span>
        <span class="token comment">//             还可以写成对象</span>
        test<span class="token punctuation">:</span><span class="token regex">/\.css$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span><span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span>
            options<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">//修改插入的方式</span>
              insertAt<span class="token punctuation">:</span><span class="token string">'top'</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'css-loader'</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// less 安装 yarn add less less-loader -D</span>
        test<span class="token punctuation">:</span><span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span><span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token punctuation">:</span><span class="token string">'style-loader'</span><span class="token punctuation">,</span>
            options<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">//修改插入的方式</span>
              insertAt<span class="token punctuation">:</span><span class="token string">'top'</span>
            <span class="token punctuation">}</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
            <span class="token string">'less-loader'</span><span class="token comment">//把less -&gt; css</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="css处理"><a href="#css处理" aria-hidden="true" class="header-anchor">#</a> css处理</h3> <ul><li>创建一个postcss.config.js</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// postcss.config.js</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'autoprefixer'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">//  yarn add mini-css-extract-plugin -D  处理css</span>
<span class="token comment">//  optimize-css-assets-webpack-plugin 压缩css</span>
<span class="token comment">//  uglifyjs-webpack-plugin 压缩js</span>
<span class="token comment">//  yarn add postcss-loader autoprefixer 处理css前缀</span>
<span class="token keyword">let</span> MiniCssExtractPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mini-css-extract-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> OptimizeCss <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'optimize-css-assets-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> UgligyJs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'uglifyjs-webpack-plugin'</span><span class="token punctuation">)</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">//优化</span>
    minimizer<span class="token punctuation">:</span><span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">OptimizeCss</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//压缩css</span>
      <span class="token keyword">new</span> <span class="token class-name">UgligyJs</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        cache<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        parallel<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        sourceMap<span class="token punctuation">:</span><span class="token boolean">true</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//压缩js js需要babel处理不然会报异常</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span><span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span><span class="token regex">/.css$/</span><span class="token punctuation">,</span>
        user<span class="token punctuation">:</span><span class="token punctuation">[</span>
          MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span><span class="token comment">// 和style-loader的区别 他是用插件抽离了在放到页面中</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span><span class="token regex">/\.less$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span><span class="token punctuation">[</span>
          MiniCssExtractPlugin<span class="token punctuation">.</span>loader<span class="token punctuation">,</span>
          <span class="token string">'css-loader'</span><span class="token punctuation">,</span>
          <span class="token string">'less-loader'</span><span class="token punctuation">,</span><span class="token comment">//把less -&gt; css</span>
          <span class="token string">'postcss-loader'</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      filename<span class="token punctuation">:</span><span class="token string">'main.css'</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="js"><a href="#js" aria-hidden="true" class="header-anchor">#</a> js</h3> <ul><li>babel</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// yarn add babel-loader @babel/core @babel/preset-env</span>
  <span class="token comment">// babel-loader 将语法转换</span>
  <span class="token comment">// @babel/core 核心模块</span>
  <span class="token comment">// @babel/preset-env 将高级的语法转换成 低级</span>
  <span class="token comment">// @babel/plugin-proposal-class-properties 处理es7 </span>
  
  <span class="token comment">// 下面两个是一起的</span>
  <span class="token comment">// yarn add  @babel/plugin-transform-runtime -D //处理 generator</span>
  <span class="token comment">// yarn add @babel/runtime //生成依赖 </span>

  <span class="token comment">// yarn add @babel/polyfill  //生成依赖  处理实例上的方法 'xx'.includes('a')</span>
  
  <span class="token comment">// yarn add eslint eslint-loader -D </span>
  module<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">// 模块</span>
    rules<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token comment">//规则 顺序默认从右向左执行,从下向上</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span><span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span><span class="token string">'eslint-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span><span class="token punctuation">{</span>
            enforce<span class="token punctuation">:</span><span class="token string">'pre'</span><span class="token comment">//设置执行顺序 previoues提前 默认是普通 post后面</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span><span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">// 用babel-loader 需要把es6-&gt;es5</span>
            presets<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">// 这个是大插件的集合</span>
            plugins<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token comment">// 可选</span>
              <span class="token punctuation">[</span><span class="token string">&quot;@babel/plugin-proposal-decorators&quot;</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;legacy&quot;</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//处理装饰器</span>
              <span class="token punctuation">[</span><span class="token string">'@babel/plugin-proposal-class-properties'</span><span class="token punctuation">,</span><span class="token punctuation">{</span><span class="token string">&quot;loose&quot;</span><span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//处理class</span>
              <span class="token string">&quot;@babel/plugin-transform-runtime&quot;</span>

            <span class="token punctuation">]</span>

          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="jquery-全局问题"><a href="#jquery-全局问题" aria-hidden="true" class="header-anchor">#</a> jquery&amp;&amp;全局问题</h3> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// 引入第三方模块 cnpm i -S jquery</span>
  <span class="token number">1</span>、 expose<span class="token operator">-</span>loader 暴露到window上  <span class="token comment">//window.$可以获取到</span>
    cnpm i <span class="token operator">-</span><span class="token constant">D</span> expose<span class="token operator">-</span>loader
    rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span>require<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'jquery'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span><span class="token string">'expose-loader?$'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>

  <span class="token number">2</span>、  webpack 插件的ProvidePlugin属性
      <span class="token keyword">let</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>ProvidePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
        <span class="token comment">//提供插件 在每个模块中都注入$</span>
        $<span class="token punctuation">:</span><span class="token string">'jquery'</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token number">3</span>、cnd引入 <span class="token keyword">import</span> $ <span class="token keyword">from</span> <span class="token string">'jquery'</span> jquery不打包
    externals<span class="token punctuation">:</span><span class="token punctuation">{</span>
      jquery<span class="token punctuation">:</span><span class="token string">&quot;$&quot;</span>
    <span class="token punctuation">}</span>  
</code></pre></div><h3 id="图片处理"><a href="#图片处理" aria-hidden="true" class="header-anchor">#</a> 图片处理</h3> <ul><li>1、在js中创建图片来引入</li> <li>2、在css引入 backgroud('url')</li> <li>3、<img src alt></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// js引入 import logo from './1.jpeg'; 会将图片转换成hash戳</span>
  <span class="token comment">// 打包:默认会在内部生成一张图片 到build目录下  把生成的图片名字返回回来</span>
  <span class="token comment">// file-loader 不用了 </span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/\.(png|jpeg|gif)$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token string">'file-loader'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// url-loader 多用这个</span>
  <span class="token comment">//  url-loader 可以处理base64 当我们图片小于多少K用base64 来转化 否则用file-loader产生真实的图片</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/\.(png|jpeg|gif)$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span><span class="token punctuation">{</span>
        limit<span class="token punctuation">:</span><span class="token number">200</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">,</span>
        outputPath<span class="token punctuation">:</span><span class="token string">'img/'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// html-withimg-loader处理html里面引入图片</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/.html$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token string">'html-withimg-loader'</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="文件分类打包"><a href="#文件分类打包" aria-hidden="true" class="header-anchor">#</a> 文件分类打包</h3> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// css /css 就是文件夹</span>
  <span class="token keyword">new</span> <span class="token class-name">MiniCssExtractPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span><span class="token string">'/css/main.css'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token comment">// img   outputPath:'img/' 指定输出文件 base64就不会打包进来</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/\.(png|jpeg|gif)$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span><span class="token punctuation">{</span>
        limit<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        outputPath<span class="token punctuation">:</span><span class="token string">'img/'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 公共路径 打包出来 都会带这个</span>
  output<span class="token punctuation">:</span><span class="token punctuation">{</span>
    publicPath<span class="token punctuation">:</span><span class="token string">'http//www.xxx.com'</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 或者只在图片上加公共路径</span>
    <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/\.(png|jpeg|gif)$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token string">'url-loader'</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span><span class="token punctuation">{</span>
        limit<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span>
        outputPath<span class="token punctuation">:</span><span class="token string">'img/'</span><span class="token punctuation">,</span>
         publicPath<span class="token punctuation">:</span><span class="token string">'http//www.xxx.com'</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h2 id="高级配置"><a href="#高级配置" aria-hidden="true" class="header-anchor">#</a> 高级配置</h2> <h3 id="多页配置"><a href="#多页配置" aria-hidden="true" class="header-anchor">#</a> 多页配置</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> HTMLWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">//多入口</span>
  mode<span class="token punctuation">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span><span class="token punctuation">{</span>
    home<span class="token punctuation">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
    other<span class="token punctuation">:</span><span class="token string">'./src/other.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">// [name] 就是一个变量 代表 entry的key值</span>
    filename<span class="token punctuation">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token comment">// 默认都会引入到html里面,要加chunks</span>
    <span class="token keyword">new</span> <span class="token class-name">HTMLWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span><span class="token string">'home.html'</span><span class="token punctuation">,</span>
      chunks<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'home'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">HTMLWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span><span class="token string">'other.html'</span><span class="token punctuation">,</span>
      chunks<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'other'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="source-map"><a href="#source-map" aria-hidden="true" class="header-anchor">#</a> source-map</h3> <ul><li>devtool：
<ul><li>1、source-map
<ul><li>源码映射 会单独生成一个source map文件 会标识 当前报错的列和行 打包会生成一个文件 大而全</li></ul></li> <li>2、eval-source-map
<ul><li>不会产生单独的文件 但是可以显示行和列</li></ul></li> <li>3、cheap-module-source-map
<ul><li>不会产生列 但是是一个单独的映射文件</li></ul></li> <li>4、cheap-module-eval-source-map
<ul><li>不会产生文件 集成在打包后的文件 不会产生列</li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> HTMLWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span><span class="token punctuation">{</span>
    home<span class="token punctuation">:</span><span class="token string">'./src/index.js'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  devtool<span class="token punctuation">:</span><span class="token string">'source-map'</span><span class="token punctuation">,</span>
  module<span class="token punctuation">:</span><span class="token punctuation">{</span>
    rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token punctuation">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
        use<span class="token punctuation">:</span><span class="token punctuation">{</span>
          loader<span class="token punctuation">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
          options<span class="token punctuation">:</span><span class="token punctuation">{</span>
            presets<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  output<span class="token punctuation">:</span><span class="token punctuation">{</span>
    filename<span class="token punctuation">:</span><span class="token string">'[name].js'</span><span class="token punctuation">,</span>
    path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HTMLWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token punctuation">:</span><span class="token string">'./index.html'</span><span class="token punctuation">,</span>
      filename<span class="token punctuation">:</span><span class="token string">'other.html'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="watch-监控打包"><a href="#watch-监控打包" aria-hidden="true" class="header-anchor">#</a> watch&amp;&amp;监控打包</h3> <ul><li>watch作用监控打包 修改代码就会重新打包</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  watch<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
  watchOptions<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">// 监控的选项</span>
    poll<span class="token punctuation">:</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token comment">// 每秒问我 1000次</span>
    aggregateTimout<span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">,</span> <span class="token comment">// 防抖 我一直输入代码 停止输入后的500</span>
    ignored<span class="token punctuation">:</span><span class="token operator">/</span>node_modules<span class="token operator">/</span>  <span class="token comment">// 不需要进行监控那个文件 </span>
  <span class="token punctuation">}</span>
</code></pre></div><h3 id="小插件"><a href="#小插件" aria-hidden="true" class="header-anchor">#</a> 小插件</h3> <ul><li>cleanWebpackPlugin
<ul><li>clean-webpack-plugin</li></ul></li> <li>copyWebpackPlugin
<ul><li>copy-webpack-plugin</li></ul></li> <li>bannerPlugin内置的</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">//删除dist文件</span>
  <span class="token keyword">let</span> CleanWebpackPlugin <span class="token operator">=</span>  <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'clean-webpack-plugin'</span><span class="token punctuation">)</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">CleanWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    
  <span class="token punctuation">]</span>
  <span class="token comment">//拷贝文件</span>
  <span class="token keyword">let</span> CopyWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'copy-webpack-plugin'</span><span class="token punctuation">)</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">CopyWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
        <span class="token punctuation">{</span><span class="token keyword">from</span><span class="token punctuation">:</span><span class="token string">'./doc'</span><span class="token punctuation">,</span>to<span class="token punctuation">:</span><span class="token string">'./'</span><span class="token punctuation">}</span>
      <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>    
  <span class="token punctuation">]</span>
  <span class="token comment">// 版权声明</span>
  <span class="token keyword">let</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
    plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
      <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>BannerPlugin</span><span class="token punctuation">(</span><span class="token string">'make xxxx'</span><span class="token punctuation">)</span><span class="token comment">//打包的js文件都加入()内的话 </span>
  <span class="token punctuation">]</span>
</code></pre></div><h3 id="跨域"><a href="#跨域" aria-hidden="true" class="header-anchor">#</a> 跨域</h3> <ul><li>重写的方式 把请求代理到express 服务器</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>devServer<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">// 开发服务器的配置 默认8080</span>
    port<span class="token punctuation">:</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token comment">// 端口</span>
    open<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 直接在浏览器打开</span>
    progress<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 开启进度条</span>
    contentBase<span class="token punctuation">:</span><span class="token string">'./dist'</span><span class="token punctuation">,</span><span class="token comment">//开启服务 指定路径</span>
    compress<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token comment">//压缩</span>
  <span class="token comment">// 1代理</span>
  proxy<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">//配置代理</span>
    <span class="token string">'/api'</span><span class="token punctuation">:</span><span class="token punctuation">{</span>
      target<span class="token punctuation">:</span><span class="token string">'http://localhost:3000'</span><span class="token punctuation">,</span>
      pathRwerite<span class="token punctuation">:</span><span class="token punctuation">{</span>
        <span class="token string">'api'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token comment">// api会被替换成&quot;&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//2 模拟数据</span>
  <span class="token function">before</span><span class="token punctuation">(</span><span class="token parameter">app</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//提供的方法 钩子</span>
    app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'xxx'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">//3 在服务端 不用代理 在服务端启动webpack 端口用服务端端口</span>
  <span class="token comment">// yarn add webpack-dev-middleware  可以在服务端启动webapck</span>
  <span class="token comment">// express 启动服务 连带着开启webpack</span>
  <span class="token keyword">let</span> express <span class="token operator">=</span> <span class="token function">rquire</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 中间件</span>
  <span class="token keyword">let</span> middle <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-dev-middleware'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpacl.config.js'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> compiler <span class="token operator">=</span>  <span class="token function">webpack</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">middle</span><span class="token punctuation">(</span>compiler<span class="token punctuation">)</span>

  app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/user'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token punctuation">:</span><span class="token string">'xxx'</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="resolve-解析"><a href="#resolve-解析" aria-hidden="true" class="header-anchor">#</a> resolve&amp;&amp;解析</h3> <div class="language-js extra-class"><pre class="language-js"><code>  resolve<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">// 解析 当我们import第三方模块 先去那儿找 </span>
    modules<span class="token punctuation">:</span><span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'node_modules'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">// 引入文件没有加后缀 会按照这个数组配置查找</span>
    extensions<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'.js'</span><span class="token punctuation">,</span><span class="token string">'.css'</span><span class="token punctuation">,</span><span class="token string">'.json'</span><span class="token punctuation">,</span><span class="token string">'.vue'</span><span class="token punctuation">]</span>
    <span class="token comment">// 文件入口 默认是index.js </span>
    mainFiles<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token comment">//  当我们 import 'bootstrap'</span>
    mainFields<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'style'</span><span class="token punctuation">,</span><span class="token string">'main'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token comment">//默认找pack.json 的main 这个配置会先去找style选项</span>
    <span class="token comment">//  当我们 import 'bootstrap' 他会去找'bootstrap/dist/css/bootstrap.css'</span>
    alias<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">//别名 </span>
      boostrap<span class="token punctuation">:</span><span class="token string">'bootstrap/dist/css/bootstrap.css'</span>
    <span class="token punctuation">}</span>

  <span class="token punctuation">}</span>
</code></pre></div><h3 id="环境变量"><a href="#环境变量" aria-hidden="true" class="header-anchor">#</a> 环境变量</h3> <ul><li>在js中直接获取的值</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DefinePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token comment">// DEV:`1+1`,console.log(DEV)//2</span>
    <span class="token comment">// DEV:`'1+1'`,console.log(DEV)//1+1</span>
    <span class="token constant">DEV</span><span class="token punctuation">:</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token string">'dev'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="区分不用环境-合并webpack"><a href="#区分不用环境-合并webpack" aria-hidden="true" class="header-anchor">#</a> 区分不用环境&amp;&amp;合并webpack</h3> <ul><li>webpack-merge</li> <li>这个插件就是用来合并的</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">//创建 webpack.prod.js</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span>smart<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> base <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.js'</span><span class="token punctuation">)</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">smart</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span><span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span><span class="token string">'production'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">//创建 webpack.dev.js</span>
  <span class="token keyword">let</span> <span class="token punctuation">{</span>smart<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack-merge'</span><span class="token punctuation">)</span>
  <span class="token keyword">let</span> base <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./webpack.base.js'</span><span class="token punctuation">)</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token function">smart</span><span class="token punctuation">(</span>base<span class="token punctuation">,</span><span class="token punctuation">{</span>
    mode<span class="token punctuation">:</span><span class="token string">'development'</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 执行</span>
  npm run build <span class="token operator">--</span> <span class="token operator">--</span>config webpack<span class="token punctuation">.</span>dev<span class="token punctuation">.</span>js
  npm run build <span class="token operator">--</span> <span class="token operator">--</span>config webpack<span class="token punctuation">.</span>prod<span class="token punctuation">.</span>js
</code></pre></div><h2 id="优化"><a href="#优化" aria-hidden="true" class="header-anchor">#</a> 优化</h2> <ul><li>noParse
<ul><li>不解析第三方库</li></ul></li> <li>exclude/include
<ul><li>解析的时候 排除哪些/包含哪些</li></ul></li> <li>IgnorePlugin
<ul><li>引入包的时候 忽略哪些文件</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">:</span><span class="token punctuation">{</span>
  <span class="token comment">//遇到很大的库 在知道他没有其他依赖的同时 可以不用解析他,节省时间</span>
  noParse<span class="token punctuation">:</span><span class="token regex">/jquery/</span><span class="token punctuation">,</span> 
  rules<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span><span class="token regex">/\.js&amp;/</span>
      exclude<span class="token punctuation">:</span><span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token comment">//js解析的时候 不去找node_modules</span>
      include<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//include 解析的时候直接去src  一般二选一</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// IgnorePlugin</span>
<span class="token comment">// 使用moment的时候  所有的语言包可以引入了 给可以给他忽略 在手动所需要的语言</span>
  <span class="token comment">// js中</span>
  <span class="token keyword">import</span> moment <span class="token keyword">from</span> <span class="token string">'moment'</span><span class="token punctuation">;</span>
  <span class="token comment">//手动引入所需要的语言</span>
  <span class="token keyword">import</span> <span class="token string">'moment/locale/zh-cn'</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>IgnorePlugin</span><span class="token punctuation">(</span><span class="token string">'/\.\/locale/'</span><span class="token punctuation">,</span><span class="token regex">/moment/</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="动态连接库"><a href="#动态连接库" aria-hidden="true" class="header-anchor">#</a> 动态连接库</h3> <ul><li>以react为例 先将react react-dom 打包出来 剩下的修改在打包</li> <li>创建动态连接库</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 创建 webpack.config.react.js</span>
<span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token punctuation">:</span><span class="token string">'development'</span><span class="token punctuation">,</span>
  entry<span class="token punctuation">:</span><span class="token punctuation">{</span>
    react<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token string">'react-dom'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  output<span class="token punctuation">:</span><span class="token punctuation">{</span>
    finame<span class="token punctuation">:</span><span class="token string">'_dll_[name].js'</span><span class="token punctuation">,</span><span class="token comment">//产生的文件名字</span>
    path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    library<span class="token punctuation">:</span><span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span> <span class="token comment">//打包的文件就是 let ab={内容}</span>
    libraryTarget<span class="token punctuation">:</span><span class="token string">'var'</span><span class="token punctuation">,</span>
    <span class="token comment">/*
       不会挂到 var  会是exports[a] = function(){}()
       如果是commonjs 会是 var a  = function(){}()
       如果是commonjs2  会是module.exports = function(){}()
       如果是this   就是this[a] = function(){}()
       global 默认是window[a] = function(){}()
       var 是 var a  = function(){}()
    */</span> 
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token comment">// 动态连接库的清单 会生成一个manifest.json文件</span>
    <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>Dllplugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token comment">//规定好的 name = library</span>
      name<span class="token punctuation">:</span><span class="token string">'_dll_[name]'</span><span class="token punctuation">,</span>
      path<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">,</span><span class="token string">'manifest.json'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>index.html 引入</li></ul> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>/_dll_react.js<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>引入动态连接库</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 主配置 webpack.config.js </span>
<span class="token keyword">let</span> webpack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'webpack'</span><span class="token punctuation">)</span>
plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>DllReferencePlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    manifest<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'dist'</span><span class="token punctuation">,</span><span class="token string">'manifest.json'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="多线程打包"><a href="#多线程打包" aria-hidden="true" class="header-anchor">#</a> 多线程打包</h3> <ul><li>happypack</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> Happypack <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'happypack'</span><span class="token punctuation">)</span>
module<span class="token punctuation">:</span><span class="token punctuation">{</span>
  reule<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span><span class="token string">'Happypack/loader?id=js'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token comment">// css 也类似</span>
  <span class="token keyword">new</span> <span class="token class-name">Happypack</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    id<span class="token punctuation">:</span><span class="token string">'js'</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">// 用babel-loader 需要把es6-&gt;es5</span>
        plugins<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token comment">// 可选</span>
          <span class="token string">'@babel/preset-env'</span><span class="token punctuation">,</span>
          <span class="token string">'@babel/preset-react'</span>
          <span class="token punctuation">]</span>
      <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span>
</code></pre></div><h3 id="webpack自带优化"><a href="#webpack自带优化" aria-hidden="true" class="header-anchor">#</a> webpack自带优化</h3> <ul><li>tree-shaking</li> <li>scope hosting</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// import 在生成环境下 会自动去除掉没用的代码(引用了 但是没有用到)</span>
<span class="token comment">// 原理 tree-shaking 把没用到的代码 自动删除掉</span>

<span class="token comment">// es6模块(require引入)会把结果放到defult上 打包的时候 不管用没用 都会打包进来</span>

<span class="token comment">// scope hosting 作用域</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> b <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> c <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> d <span class="token operator">=</span> a<span class="token operator">+</span>b<span class="token operator">+</span>c<span class="token punctuation">;</span><span class="token comment">// 在webpack中会自动省略一些 可以简化的代码</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span>
</code></pre></div><h3 id="抽离公共代码"><a href="#抽离公共代码" aria-hidden="true" class="header-anchor">#</a> 抽离公共代码</h3> <div class="language-js extra-class"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  optimization<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">// 分割代码块</span>
    cacheGroups<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">//缓存组</span>
      common<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">//公共的模块</span>
        chunks<span class="token punctuation">:</span><span class="token string">'initial'</span><span class="token punctuation">,</span>
        minSize<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        minChunks<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">//引用多2次以上就会抽离</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      vendor<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token comment">//第三方单独抽出</span>
        priority<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 权重 增加</span>
        test<span class="token punctuation">:</span><span class="token regex">/node_modules/</span><span class="token punctuation">,</span><span class="token comment">//把你抽离出来</span>
        chunks<span class="token punctuation">:</span><span class="token string">'initial'</span><span class="token punctuation">,</span>
        minSize<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span>
        minChunks<span class="token punctuation">:</span><span class="token number">2</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="懒加载"><a href="#懒加载" aria-hidden="true" class="header-anchor">#</a> 懒加载</h3> <ul><li>@babel/plugin-syntax-dynamic-import</li> <li>import('./xx.js') 返回的是一个then</li> <li>vue.js 和 react 懒加载都基于这个</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 页面点击 的时候 资源才加载进来</span>
<span class="token keyword">let</span> button <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">createElement</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> <span class="token string">'hello'</span><span class="token punctuation">;</span>
button<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'click'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// es6 草案中的语法 jsonp实现动态加载文件</span>
  <span class="token comment">// 会生成一个单独的js</span>
  <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">'./source.js'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>default<span class="token punctuation">,</span><span class="token string">'这里面才是结果'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
document<span class="token punctuation">.</span>body<span class="token punctuation">.</span><span class="token function">appendChild</span><span class="token punctuation">(</span><span class="token parameter">button</span><span class="token punctuation">)</span>

<span class="token punctuation">{</span>
  test<span class="token punctuation">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span><span class="token comment">//默认查找所有的js</span>
  use<span class="token punctuation">:</span><span class="token punctuation">{</span>
    loader<span class="token punctuation">:</span><span class="token string">'babel-loader'</span><span class="token punctuation">,</span>
    options<span class="token punctuation">:</span><span class="token punctuation">{</span>
      presets<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'@babel/preset-env'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token comment">// 插件安装 在js配置就可以了</span>
      plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
        <span class="token string">&quot;@babel/plugin-syntax-dynamic-import&quot;</span>
      <span class="token punctuation">]</span>

    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre></div><h3 id="热更新"><a href="#热更新" aria-hidden="true" class="header-anchor">#</a> 热更新</h3> <ul><li>默认更新页面内容 页面会刷新</li> <li>热更新 不会刷新页面 只会局部更新
<ul><li>import只能在顶部引用 不能在函数内引用</li></ul></li> <li>require引入的数据都是 default属性下</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 使用</span>
<span class="token keyword">import</span> xx <span class="token keyword">from</span> <span class="token string">'./xxx.js'</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>hot<span class="token punctuation">)</span><span class="token punctuation">{</span>
  module<span class="token punctuation">.</span>hot<span class="token punctuation">.</span><span class="token function">accept</span><span class="token punctuation">(</span><span class="token string">'./source'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token comment">// 更新成功 再次引入</span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./source'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// 配置</span>
devServer<span class="token punctuation">:</span><span class="token punctuation">{</span>
  hot<span class="token punctuation">:</span><span class="token boolean">true</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>HotModuleReplacementPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//热更新插件</span>
  <span class="token keyword">new</span> <span class="token class-name">webpack<span class="token punctuation">.</span>NamedModulesPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//打印更新的模块路径</span>
<span class="token punctuation">]</span>
</code></pre></div><h2 id="tapable"><a href="#tapable" aria-hidden="true" class="header-anchor">#</a> tapable</h2> <ul><li>SyncHook 同步</li> <li>SyncBailHook 遇到返回值是undefined 才继续执行</li> <li>SyncWaterfallHook 瀑布 上一个函数有返回值就会传递给下一个做参数</li> <li>SyncLoopHook 循环执行 遇到某个不返回undefined的监听函数会多次执行</li> <li>同步</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 同步</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>SyncHook<span class="token punctuation">,</span> SyncBailHook<span class="token punctuation">,</span>SyncWaterfallHook<span class="token punctuation">,</span><span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Lesson1</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      <span class="token comment">// 必须传递一个值过去</span>
      arch<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 注册监听函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">arch</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lesson1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//注册这两个事件</span>
l<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'xxxxxxxx'</span><span class="token punctuation">)</span> <span class="token comment">//启动钩子</span>


<span class="token comment">// 阻塞</span>
<span class="token keyword">class</span> <span class="token class-name">Lesson2</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      arch<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncBailHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 注册监听函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
      <span class="token comment">// return '想停止学习'</span>
      <span class="token comment">//如是返回 undefined 就继续执行</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">arch</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lesson2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//注册这两个事件</span>
l<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">)</span> <span class="token comment">//启动钩子</span>

<span class="token comment">// 瀑布</span>
<span class="token keyword">class</span> <span class="token class-name">Lesson3</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      arch<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncWaterfallHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 注册监听函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token comment">//xx</span>
      <span class="token keyword">return</span> <span class="token string">'想停止学习'</span>
      <span class="token comment">//如是返回 undefined 就继续执行</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span><span class="token comment">//想停止学习</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">arch</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lesson4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//注册这两个事件</span>
l<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">)</span> <span class="token comment">//启动钩子</span>


<span class="token keyword">class</span> <span class="token class-name">Lesson</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      arch<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncLoopHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 注册监听函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
      <span class="token keyword">return</span> <span class="token operator">++</span> <span class="token keyword">this</span><span class="token punctuation">.</span>index <span class="token operator">===</span> <span class="token number">3</span><span class="token operator">?</span> <span class="token string">'undefined'</span> <span class="token punctuation">:</span><span class="token string">'随便'</span>
      <span class="token comment">//如是返回不是undefined 就一直循环 </span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">arch</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lesson4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//注册这两个事件</span>
l<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">)</span> <span class="token comment">//启动钩子</span>
</code></pre></div><ul><li>异步</li> <li>AsyncParallelHook 异步并行 等cb都执行完成 才会打印end</li> <li>AsyncSeriesHook 异步穿行 一个个执行</li> <li>AsyncSeriesWaterfallHook 异步有关联 上一个返回非undefined值 下一个才会执行 否则直接end</li> <li>tapable库 注册三种方法 tap(同步) tapAsync(cb) tapPromise(注册是promise)
<ul><li>对应调用的方法 call callAsync promise</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 异步 并行钩子 需要等待所有的并发异步事件执行后在执行回调方法</span>
<span class="token comment">// 注册方法 分为 tap/tapAsync </span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>AsyncParallelHook<span class="token punctuation">,</span>AsyncSeriesHook<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">Lesson1</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      arch<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">AsyncParallelHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 注册监听函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
       <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">callAsync</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">w</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lesson2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//注册这两个事件</span>
l<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">)</span> <span class="token comment">//启动钩子</span>

<span class="token comment">// 异步串行</span>
<span class="token keyword">class</span> <span class="token class-name">Lesson</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      arch<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">AsyncParallelHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 注册监听函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lesson2</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//注册这两个事件</span>
l<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">)</span> <span class="token comment">//启动钩子</span>

<span class="token keyword">class</span> <span class="token class-name">Lesson3</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      arch<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 注册监听函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lesson3</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//注册这两个事件</span>
l<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">)</span> <span class="token comment">//启动钩子</span>

<span class="token comment">// AsyncSeriesWaterfallHook 异步</span>
<span class="token keyword">class</span> <span class="token class-name">Lesson4</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>index<span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      arch<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">AsyncSeriesWaterfallHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 注册监听函数</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
     <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'node'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
        <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
       <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
         console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'react'</span><span class="token punctuation">,</span>name<span class="token punctuation">)</span>
         <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">start</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>arch<span class="token punctuation">.</span><span class="token function">promise</span><span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'end'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> l <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Lesson4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
l<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//注册这两个事件</span>
l<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token string">'xx'</span><span class="token punctuation">)</span> <span class="token comment">//启动钩子</span>

</code></pre></div><h2 id="resolveloader解析loader路径的"><a href="#resolveloader解析loader路径的" aria-hidden="true" class="header-anchor">#</a> resolveLoader解析loader路径的</h2> <div class="language-js extra-class"><pre class="language-js"><code>resolveLoader<span class="token punctuation">:</span><span class="token punctuation">{</span>
  <span class="token comment">// 第三方模块默认 查找的位子</span>
  modules<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'node_modules'</span><span class="token punctuation">,</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'loaders'</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
  <span class="token comment">// 配置别名</span>
  alias<span class="token punctuation">:</span><span class="token punctuation">{</span>
    <span class="token comment">// 在loader中使用 loader1 就指向 __dirname/loaders/loaders1.js</span>
    loader1<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'loaders'</span><span class="token punctuation">,</span><span class="token string">'loaders1'</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="手写webapck"><a href="#手写webapck" aria-hidden="true" class="header-anchor">#</a> 手写webapck</h2> <ul><li><p>npx webpack</p> <ul><li>会去找node_modules/.bin/webpack</li></ul></li> <li><p>制作webpack包(下面有)</p></li> <li><p>npm link webpack-pack 就引入到本地了 他会出现在node_modules/.bin/webpack-pack</p></li> <li><p>直接运行 npm webpack-pack 就可以运行webpack-pack里面的代码(类似npx webpack 打包一样)</p></li> <li><p>获取cmd输入命名行的路径=&gt; proccess.cwd()</p></li> <li><p>本地生成npm包(类似 webpack)</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code> 创建本地文件  npm init <span class="token operator">-</span>y

 创建 bin<span class="token operator">/</span>webpack<span class="token operator">-</span>pack<span class="token punctuation">.</span>js
  <span class="token parameter">输入</span><span class="token operator">=&gt;</span>
  #<span class="token operator">!</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'12'</span><span class="token punctuation">)</span>

  <span class="token keyword">package</span><span class="token punctuation">.</span>json
  <span class="token parameter">输入</span><span class="token operator">=&gt;</span>
  <span class="token string">&quot;bin&quot;</span><span class="token punctuation">:</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;webpack-pack&quot;</span><span class="token punctuation">:</span> <span class="token string">&quot;./bin/webpack-pack.js&quot;</span>
  <span class="token punctuation">}</span>
  
  运行 npm link
</code></pre></div><ul><li>制作 webpack-pack</li> <li>webpack-pack/bin/index 入口文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>#<span class="token operator">!</span> <span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node
<span class="token comment">// 1、获取webpack.config.js 配置文件</span>
<span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 2、通过当前执行命令的目录 解析除webpack.config.js 在那儿执行就在那儿找webpack.config.js</span>
<span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token string">'webpack.config.js'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> 

<span class="token comment">// 主的类 Compiler 编译</span>
<span class="token keyword">let</span> Compiler <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'../lib/Compiler.js'</span><span class="token punctuation">)</span>

<span class="token comment">// 根据用户创建的配置文件 进行编译</span>
<span class="token keyword">let</span> compiler <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Compiler</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span>

compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">entryOption</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

compiler<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment">//开始运行</span>
</code></pre></div><ul><li>webpack-pack/lib/Compiler</li> <li>babylon 解析（parse）
<ul><li>Babylon 是 Babel 的解析器。最初是 从Acorn项目fork出来的。Acorn非常快，易于使用。</li></ul></li> <li>@babel/traverse
<ul><li>Babel Traverse（遍历）模块维护了整棵树的状态，并且负责替换、移除和添加节点。我们可以和 Babylon 一起使用来遍历和更新节点。</li></ul></li> <li>@babel/generator
<ul><li>Babel Generator模块是 Babel 的代码生成器，它读取AST并将其转换为代码和源码映射</li></ul></li> <li>webpack流程
<ul><li>1、获取配置文件(webpack.config.js)</li> <li>2、获取所有的资源(this.getSource =&gt;只针对 require 引入的文件)</li> <li>3、buildMoudle 函数 获取每一个 绝对路径(moduleId)对应的代码(sourceCode) ast解析(this.parse)</li> <li>4、ejs配合模板渲染数据 ejs.render()</li> <li>5、根据配置文件的output 路径 将获取的数据写入</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// ejs 用来拼接字符串</span>
<span class="token comment">// tapable 用来发布订阅</span>
<span class="token keyword">let</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//  下面4个功能 ast  1) 转换树 2) 遍历树 3)更改树  4)输出代码</span>
<span class="token keyword">let</span> babylon <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'babylon'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 转换成树</span>
<span class="token keyword">let</span> traverse <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/traverse'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span> <span class="token comment">// 遍历树</span>
<span class="token keyword">let</span> t <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/types'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 更改树 es模块需要 多.default</span>
<span class="token keyword">let</span> generator <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/generator'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>default<span class="token punctuation">;</span>

<span class="token keyword">let</span> ejs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'ejs'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span>SyncHook<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'tapable'</span><span class="token punctuation">)</span>

<span class="token keyword">class</span> <span class="token class-name">Compiler</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">config</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 配置文件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>config <span class="token operator">=</span> config
    <span class="token comment">// 需要获取当前执行命令的绝对路径</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">cwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 找到配置文件中的入口</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entry <span class="token operator">=</span> config<span class="token punctuation">.</span>entry
    <span class="token comment">// 入口文本的id</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>entryId<span class="token punctuation">;</span>
    <span class="token comment">//所有的依赖列表</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
      entryOption<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      run<span class="token punctuation">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      compile<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      afterCompile<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      afterPlugins<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//插件都执行完成后调用此方法</span>
      emit<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment">//文件发射出来了</span>
      done<span class="token punctuation">:</span><span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token comment">// 每个插件都需要有一个apply方法</span>
        <span class="token function">p</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//每个插件都能拿到compiler对象</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterPlugins</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token punctuation">}</span>
  <span class="token function">getSource</span><span class="token punctuation">(</span><span class="token parameter">modulePath</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//获取资源</span>
    <span class="token comment">// 需要判断 modulePath 是否是less文件</span>
    <span class="token comment">// 获取规则</span>
    <span class="token keyword">let</span> rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">;</span><span class="token comment">//所有的规则</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rules<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> rule <span class="token operator">=</span> rules<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span>test<span class="token punctuation">,</span>use<span class="token punctuation">}</span> <span class="token operator">=</span> rule
      <span class="token keyword">let</span> len <span class="token operator">=</span> use<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//默认定位到最后一个loader</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 这个路径需要用loader来解析</span>
        <span class="token keyword">function</span> <span class="token function">normalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// loader 可以是一个路径 本质是一个函数</span>
          <span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>use<span class="token punctuation">[</span>len<span class="token operator">--</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          content <span class="token operator">=</span> <span class="token function">loader</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">normalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//递归来解析loader</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">normalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> content
  <span class="token punctuation">}</span>
  <span class="token comment">// 创建模块</span>
  <span class="token comment">// 第一个是绝对路径 第二个是否是主入口</span>
  <span class="token function">buildMoudle</span><span class="token punctuation">(</span><span class="token parameter">modulePath<span class="token punctuation">,</span>isEntry</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 文件源代码</span>
    <span class="token keyword">let</span> source <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span>
    <span class="token comment">// modulePath 目前是绝对路径 path.relative在绝对路径中找相对路径</span>
    <span class="token keyword">let</span> moduleId <span class="token operator">=</span> <span class="token string">'./'</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">relative</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root <span class="token punctuation">,</span> modulePath<span class="token punctuation">)</span>
    <span class="token comment">// console.log('==',moduleId,'-',source)</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>isEntry<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">//如果是主模块</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>entryId <span class="token operator">=</span> moduleId
    <span class="token punctuation">}</span>
    <span class="token comment">// AST语法解析 写一个专门的方法来解析源代码</span>
    <span class="token comment">// 处理当前模块的父路径 path.dirname</span>
    <span class="token comment">// sourceCode就是转换后的代码</span>
    <span class="token keyword">let</span> <span class="token punctuation">{</span>sourceCode<span class="token punctuation">,</span>dependencies<span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span>path<span class="token punctuation">.</span><span class="token function">dirname</span><span class="token punctuation">(</span>moduleId<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// 取到的就是./src</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span> sourceCode<span class="token punctuation">;</span>
    <span class="token comment">// 需要拿到当前文件的依赖 递归搜索依赖</span>
    dependencies<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">dep</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildMoudle</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span>dep<span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// console.log('sourceCode',dependencies)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// yarn add babylon @babel/traverse @babel/generator @babel/types</span>
  <span class="token function">parse</span><span class="token punctuation">(</span><span class="token parameter">source<span class="token punctuation">,</span>parentPath</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> ast <span class="token operator">=</span> babylon<span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span>
    <span class="token keyword">let</span> dependencies <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">//存放依赖关系的</span>
    <span class="token function">traverse</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span><span class="token punctuation">{</span>
      <span class="token function">CallExpression</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> node <span class="token operator">=</span> p<span class="token punctuation">.</span>node<span class="token punctuation">;</span>
        <span class="token comment">// 找到require</span>
        <span class="token keyword">if</span><span class="token punctuation">(</span>node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">===</span> <span class="token string">'require'</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//取到名字</span>
          node<span class="token punctuation">.</span>callee<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'__webpack_require__'</span><span class="token punctuation">;</span>
          <span class="token keyword">let</span> moduleName <span class="token operator">=</span> node<span class="token punctuation">.</span>arguments<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
          moduleName <span class="token operator">=</span> moduleName <span class="token operator">+</span> <span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">extname</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span><span class="token operator">?</span><span class="token string">''</span><span class="token punctuation">:</span><span class="token string">'.js'</span><span class="token punctuation">)</span>
          moduleName <span class="token operator">=</span> <span class="token string">'./'</span> <span class="token operator">+</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span>parentPath<span class="token punctuation">,</span>moduleName<span class="token punctuation">)</span>
          <span class="token comment">// 把依赖添加进去</span>
          dependencies<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span>
          <span class="token comment">// 替换变量名</span>
          node<span class="token punctuation">.</span>arguments <span class="token operator">=</span> <span class="token punctuation">[</span>t<span class="token punctuation">.</span><span class="token function">stringLiteral</span><span class="token punctuation">(</span>moduleName<span class="token punctuation">)</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">let</span> sourceCode <span class="token operator">=</span> <span class="token function">generator</span><span class="token punctuation">(</span>ast<span class="token punctuation">)</span><span class="token punctuation">.</span>code<span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span>sourceCode<span class="token punctuation">,</span>dependencies<span class="token punctuation">}</span>
    <span class="token comment">// ast 1) 转换树 2) 遍历树 3)更改树  4)输出代码</span>
    <span class="token comment">// esprima es-travarse esCodegen(webpack用的这个) 语法转换</span>
    <span class="token comment">// babel(babylon  @babel/traverse  @babel/types @babel/generator) 对应上面的1-4</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// 开始运行</span>
  <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 1、创建模块 需要根据当前的绝对路径</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">compile</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildMoudle</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>root<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>entry<span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">afterCompile</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// console.log(this.entryId,this.modules)</span>
    <span class="token comment">// 2、创建完后 把成功的文件写出来</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//发射文件</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>hooks<span class="token punctuation">.</span><span class="token function">done</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">emitFile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 模板内容</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">getSource</span><span class="token punctuation">(</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'temp.ejs'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token comment">// </span>
    <span class="token keyword">let</span> str <span class="token operator">=</span> ejs<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>content<span class="token punctuation">,</span><span class="token punctuation">{</span>
      modules<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>modules<span class="token punctuation">,</span>
      entryId<span class="token punctuation">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>entryId
    <span class="token punctuation">}</span><span class="token punctuation">)</span> 
    <span class="token comment">// 写入打包到的文件中</span>
    <span class="token keyword">let</span> main <span class="token operator">=</span> path<span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>path<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>output<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">;</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span>main<span class="token punctuation">,</span>str<span class="token punctuation">)</span>

  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> Compiler
</code></pre></div><ul><li>webpack-pack/lib/temp.ejs</li></ul> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">modules</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> installedModules <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span><span class="token parameter">moduleId</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">var</span> module <span class="token operator">=</span> installedModules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span> <span class="token operator">=</span><span class="token punctuation">{</span>
      i<span class="token punctuation">:</span> moduleId<span class="token punctuation">,</span>
      l<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      exports<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>

    modules<span class="token punctuation">[</span>moduleId<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> module<span class="token punctuation">,</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">,</span> __webpack_require__<span class="token punctuation">)</span><span class="token punctuation">;</span>
   
    module<span class="token punctuation">.</span>l <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> module<span class="token punctuation">.</span>exports<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">__webpack_require__</span><span class="token punctuation">(</span>__webpack_require__<span class="token punctuation">.</span>s <span class="token operator">=</span> <span class="token string">&quot;&lt;%-entryId%&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">in</span> modules<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token operator">%</span><span class="token operator">&gt;</span>
      <span class="token string">&quot;&lt;%-key%&gt;&quot;</span><span class="token punctuation">:</span>
      <span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">module<span class="token punctuation">,</span>exports<span class="token punctuation">,</span>__webpack_require__</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token template-string"><span class="token string">`&lt;%-modules[key]%&gt;`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token operator">&lt;</span><span class="token operator">%</span><span class="token punctuation">}</span><span class="token operator">%</span><span class="token operator">&gt;</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><h2 id="手写loader"><a href="#手写loader" aria-hidden="true" class="header-anchor">#</a> 手写loader</h2> <ul><li>loader组成 pitch + normal
<ul><li>loader里面的
<ul><li>this.resourcePath 获取匹配到文件的路径</li> <li>loaderUtils = require('loader-utils')  options = loaderUtils.getOptions(this); options 是当前webpack配置的选项
<ul><li>let filename = loaderUtils.interpolateName(this,'[hash].[ext]',{content:source})  根据图片格式生成图片路径</li> <li>this.emitFile(filename,source) // 发射文件</li></ul></li> <li>同步 用return source 返回数据  异步用 cb = this.async()  cb(err,source) 返回数据</li> <li>validateOptions = require('schema-utils') 创建骨架 用来比较传递进来的骨架是否类似</li> <li>loader 默认是字符串  当前loader.raw = true 将字符串转换成二进制流</li></ul></li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 3个loader</span>
<span class="token comment">// loader1 文件</span>
<span class="token keyword">function</span> <span class="token function">loader1</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//normal</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'1111'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> source
<span class="token punctuation">}</span>
loader1<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span> <span class="token comment">//pitch</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loader1'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader1

<span class="token comment">// loader2 文件</span>
<span class="token keyword">function</span> <span class="token function">loader1</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'222'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> source
<span class="token punctuation">}</span>
loader1<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loader3'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader1


<span class="token comment">// loader3 文件</span>
<span class="token keyword">function</span> <span class="token function">loader1</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'333'</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> source
<span class="token punctuation">}</span>
loader1<span class="token punctuation">.</span><span class="token function-variable function">pitch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'loader3'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader1


rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/.js$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'loader1'</span><span class="token punctuation">,</span><span class="token string">'loader2'</span><span class="token punctuation">,</span><span class="token string">'loader3'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token comment">// 正常情况下没有pitch 执行顺序应该是 loader3=&gt;loader2=&gt;loader1=&gt;</span>
<span class="token comment">// 加入pitch loader1.pitch =&gt; loader2.pitch =&gt; loader3.pitch =&gt;loader3=&gt;loader2=&gt;loader1</span>
<span class="token comment">/* 
  pitch作用 
  若返回一个 字符串 那么跳过后面的pitch 和跳过当前的loader 进入下一个loader
  比如 loader2.pitch return一个字符串 loader1.pitch =&gt; loader2.pitch =&gt;loader1 (loader3.pitch =&gt;loader3=&gt;loader2 不会执行)
*/</span>
</code></pre></div><ul><li>写法</li> <li>顺序问题 从右到左 从下到上</li> <li>loader的分类
<ul><li>pre 在前面(enforce:pre,enforce来设置顺序)</li> <li>post 在后面</li> <li>normal 中间的</li> <li>顺序pre-&gt;normal-&gt;inline-&gt;post</li> <li>inline-loader 内联loader 在代码中使用 不在webacpk内配置</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//1 、</span>
rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/.js$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token punctuation">[</span><span class="token string">'loader1'</span><span class="token punctuation">,</span><span class="token string">'loader2'</span><span class="token punctuation">,</span><span class="token string">'loader3'</span><span class="token punctuation">]</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token comment">//2 、</span>
rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/.js$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token string">'loader1'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/.js$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token string">'loader2'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
    test<span class="token punctuation">:</span><span class="token regex">/.js$/</span><span class="token punctuation">,</span>
    use<span class="token punctuation">:</span><span class="token punctuation">{</span>
      loader<span class="token punctuation">:</span><span class="token string">'loader3'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span>
<span class="token number">3</span>、
<span class="token comment">// 创建 inline.js</span>
<span class="token keyword">function</span> <span class="token function">inlineLaoder</span> <span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'inline------------------'</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span>
  <span class="token keyword">return</span> source
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> inlineLaoder

<span class="token comment">// index.js</span>
<span class="token keyword">let</span> a <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'!!inline!./1.js'</span><span class="token punctuation">)</span>
<span class="token comment">// 内联loader 只有在引用的时候处理 其他情况下不处理  在前面家前缀有不同的效果 inline loader不会每个文件都处理</span>
<span class="token comment">// -! 不会让文件 在去通过pre + normal loader来处理了</span>
<span class="token comment">// ! 没有normal</span>
<span class="token comment">// !! 上面都不要 只要inline 来处理</span>
</code></pre></div><ul><li>loader 接受content('文件内容')
<ul><li>1、loader 都是函数 参数就是所有文件的内容</li> <li>2、最后一个loader需要 返回一个js脚本的字符串 去执行</li> <li>3、每个loader只做一件内容 为了使loader在个人难过场景链式使用</li> <li>4、每一个loader都是一个模块</li> <li>5、每个loader都是无状态的 确保loader在不同模块转换之间不保持状态</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">//  原理 </span>
 <span class="token function">getSource</span><span class="token punctuation">(</span><span class="token parameter">modulePath</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">//获取资源</span>
    <span class="token comment">// 需要判断 modulePath 是否是less文件</span>
    <span class="token comment">// 获取规则</span>
    <span class="token keyword">let</span> rules <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>config<span class="token punctuation">.</span>module<span class="token punctuation">.</span>rules<span class="token punctuation">;</span><span class="token comment">//所有的规则</span>
    <span class="token keyword">let</span> content <span class="token operator">=</span> fs<span class="token punctuation">.</span><span class="token function">readFileSync</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>rules<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> rule <span class="token operator">=</span> rules<span class="token punctuation">[</span>i<span class="token punctuation">]</span>
      <span class="token keyword">let</span> <span class="token punctuation">{</span>test<span class="token punctuation">,</span>use<span class="token punctuation">}</span> <span class="token operator">=</span> rule
      <span class="token keyword">let</span> len <span class="token operator">=</span> use<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//默认定位到最后一个loader</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span>test<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>modulePath<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 这个路径需要用loader来解析</span>
        <span class="token keyword">function</span> <span class="token function">normalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
          <span class="token comment">// loader 原理</span>
          <span class="token keyword">let</span> loader <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span>use<span class="token punctuation">[</span>len<span class="token operator">--</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token comment">// content 文件内容</span>
          content <span class="token operator">=</span> <span class="token function">loader</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token operator">&gt;=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token function">normalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//递归来解析loader</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token function">normalLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> content
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>实现自己的loader
<ul><li>作用:每个文件都加上自己想要注释的内容</li></ul></li> <li>banner-loader</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// banner-loader 编写</span>
<span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>
<span class="token comment">// loaderUtils可以获取loader下面的options</span>
<span class="token keyword">let</span> validateOptions <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'schema-utils'</span><span class="token punctuation">)</span>
<span class="token comment">// 创建骨架 用来比较传递进来的骨架是否类似</span>
<span class="token keyword">let</span> fs <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'fs'</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// 是否开启缓存</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">cacheable</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span>
   <span class="token keyword">let</span> options <span class="token operator">=</span>  loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span>
   <span class="token comment">// 异步用this.async返回 否则直接用return</span>
   <span class="token keyword">let</span> cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
   <span class="token keyword">let</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
     type<span class="token punctuation">:</span><span class="token string">'object'</span><span class="token punctuation">,</span>
     properties<span class="token punctuation">:</span><span class="token punctuation">{</span>
       text<span class="token punctuation">:</span><span class="token punctuation">{</span>
         type<span class="token punctuation">:</span><span class="token string">'string'</span><span class="token punctuation">,</span>
       <span class="token punctuation">}</span><span class="token punctuation">,</span>
       filename<span class="token punctuation">:</span><span class="token punctuation">{</span>
         type<span class="token punctuation">:</span><span class="token string">'string'</span>
       <span class="token punctuation">}</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
   <span class="token function">validateOptions</span><span class="token punctuation">(</span>schema<span class="token punctuation">,</span>options<span class="token punctuation">,</span><span class="token string">'banner-loader'</span><span class="token punctuation">)</span>
   <span class="token keyword">if</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">// 自动添加文件依赖  webapck开启watch:true 作用 依赖文件变化wenpack会重新打包</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">addDependency</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">)</span>
     fs<span class="token punctuation">.</span><span class="token function">readFile</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>filename<span class="token punctuation">,</span><span class="token string">'utf8'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>data</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span><span class="token template-string"><span class="token string">`/**</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>data<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">**/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
      <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token template-string"><span class="token string">`/**</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>options<span class="token punctuation">.</span>text<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">**/</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader<span class="token punctuation">;</span>

<span class="token comment">//  webapck配置</span>
watch<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
module<span class="token punctuation">:</span><span class="token punctuation">{</span>
  rules<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      test<span class="token punctuation">:</span><span class="token regex">/\.js$/</span><span class="token punctuation">,</span>
      use<span class="token punctuation">:</span><span class="token punctuation">{</span>
        loader<span class="token punctuation">:</span><span class="token string">'banner-loader'</span><span class="token punctuation">,</span>
        options<span class="token punctuation">:</span><span class="token punctuation">{</span>
          presets<span class="token punctuation">:</span><span class="token punctuation">{</span>
            text<span class="token punctuation">:</span><span class="token string">'测试1'</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          filename<span class="token punctuation">:</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span><span class="token string">'banner.js'</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// 创建banner.js文件  输入=&gt; songge</span>
</code></pre></div><ul><li>babel-loader实现
<ul><li>yarn add @babel/core @babel/preset-env</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> babel <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@babel/core'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token comment">// this 当前上下文</span>
  <span class="token keyword">let</span> options <span class="token operator">=</span>  loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> cb <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">async</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  babel<span class="token punctuation">.</span><span class="token function">transform</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>options<span class="token punctuation">,</span>
    sourceMap<span class="token punctuation">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
    filename<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>result</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token function">cb</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span>result<span class="token punctuation">.</span>code<span class="token punctuation">.</span>result<span class="token punctuation">.</span>map<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader
</code></pre></div><ul><li>less-loader</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">// less 模块</span>
  <span class="token keyword">let</span> less <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'less'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">let</span> css<span class="token punctuation">;</span>
    <span class="token comment">// 转换的过程,同步 </span>
    less<span class="token punctuation">.</span><span class="token function">render</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span>output</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      css <span class="token operator">=</span> output<span class="token punctuation">.</span>css
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// css = css.replace(/\n/g,'\n')</span>
    <span class="token keyword">return</span> css
  <span class="token punctuation">}</span>
  module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader
</code></pre></div><ul><li>style-loader</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment">//source less-loader转换后的结果</span>
  <span class="token comment">//最终的loader需要 返回一个js脚本的字符串</span>
  <span class="token keyword">let</span> str <span class="token operator">=</span> <span class="token template-string"><span class="token string">`
  let style = document.createElement('style');
  style.innerHTML = </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
  document.head.appendChild(style)
  `</span></span>
  <span class="token keyword">return</span> str
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader
</code></pre></div><ul><li>file-loader</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>

<span class="token comment">// 他要导出一个路径</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'source'</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span>
  <span class="token comment">// 根据图片格式生成图片路径</span>
  <span class="token keyword">let</span> filename <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">interpolateName</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span><span class="token string">'[hash].[ext]'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>content<span class="token punctuation">:</span>source<span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">emitFile</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">// 发射文件</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`module.exports = &quot;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;`</span></span>
<span class="token punctuation">}</span>
loader<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span> <span class="token comment">// 将源码转换成二进制</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader
</code></pre></div><p>-url-loader</p> <div class="language-js extra-class"><pre class="language-js"><code>
<span class="token keyword">let</span> loaderUtils <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'loader-utils'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> mime <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'mime'</span><span class="token punctuation">)</span>
<span class="token keyword">function</span> <span class="token function">loader</span><span class="token punctuation">(</span><span class="token parameter">source</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">let</span> options <span class="token operator">=</span> loaderUtils<span class="token punctuation">.</span><span class="token function">getOptions</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> limit <span class="token operator">=</span> options<span class="token punctuation">.</span>limit
  <span class="token keyword">if</span><span class="token punctuation">(</span>limit <span class="token operator">&amp;&amp;</span> limit <span class="token operator">&gt;</span>source<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// this.resourcePath 文件路径</span>
    <span class="token keyword">return</span> <span class="token template-string"><span class="token string">`module.exports = &quot;data:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>mime<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resourcePath<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">;
    base64,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>source<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token string">'base64'</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&quot;`</span></span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'./file-loader'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span>source<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
loader<span class="token punctuation">.</span>raw <span class="token operator">=</span> <span class="token boolean">true</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> loader
<span class="token comment">// base64 格式 data:image/jpeg;base64,xxxxx;</span>
</code></pre></div><h2 id="webpack-流程"><a href="#webpack-流程" aria-hidden="true" class="header-anchor">#</a> webpack 流程</h2> <ul><li>1、webpack.config.js 解析 成一个对象</li> <li>2、compiler编译 compiler=webpack(options); webapck初始化
<ul><li>a、创建Compiler对象</li> <li>b、注册NodeEnvironmentPlugin插件</li> <li>c、挂在options中的plugins插件</li> <li>d、使用webpackOtptionApply初始化基础插件</li></ul></li> <li>3、run(开始编译)
<ul><li>a、调用compile开启编译</li> <li>b、创建Compilation对象
<ul><li>1、负责整体编译过程</li> <li>2、内部保留对compiler对象引用this.compiler</li> <li>3、this.entries入口</li> <li>4、this.modules 所有模块</li> <li>5、this.chunks 代码块</li> <li>6、this.assets 所有的资源</li> <li>7、template</li></ul></li></ul></li> <li>4、buildMoudle分析入口文件创建模块对象
<ul><li>1、获取所有资源</li> <li>2、AST语法解析</li> <li>3、递归搜索依赖</li></ul></li> <li>5、emitFile();//发射文件</li></ul> <h2 id="手写plugin"><a href="#手写plugin" aria-hidden="true" class="header-anchor">#</a> 手写plugin</h2> <ul><li>插件都是类 作用监听每个钩子上的事件
<ul><li>每个插件都要有一个apply 方法</li> <li>插件都是类 this 就是compile对象</li></ul></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token comment">//原理</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>plugins<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    config<span class="token punctuation">.</span>plugins<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">p</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token comment">// 每个插件都需要有一个 apply 方法</span>
      <span class="token function">p</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//每个插件都能拿到 compiler(this) 对象</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>同步&amp;&amp;异步插件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 同步</span>
<span class="token keyword">class</span> <span class="token class-name">DonePlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'DonePlugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">stats</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'编译完成~~'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> DonePlugin
<span class="token comment">// 异步</span>
<span class="token keyword">class</span> <span class="token class-name">AsyncPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'222222222222'</span><span class="token punctuation">)</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">'AsyncPlugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">compliation<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'编译完成~~22'</span><span class="token punctuation">)</span>
          <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">'AsyncPlugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">compliation</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span>reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'编译完成~~333'</span><span class="token punctuation">)</span>
          <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> AsyncPlugin
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">P1</span>  <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'p1'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'done'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">P2</span>  <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>afterCompile<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'p2'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'afterCompile'</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
  plugins<span class="token punctuation">:</span><span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">P1</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">new</span> <span class="token class-name">P2</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span>
</code></pre></div><ul><li>FileListPlugin 显示文件名字 和大小插件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">FileListPlugin</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span>filename<span class="token punctuation">}</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>filename <span class="token operator">=</span> filename
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 文件已经准备好了 要进行发射</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'compiler'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">compilcation</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> assets <span class="token operator">=</span> compilcation<span class="token punctuation">.</span>assets<span class="token punctuation">;</span>
        <span class="token comment">// assets 存放所有打包资源 打包之后 就是bundle.js文件和index.html文件 后面添加 就直接打包添加的文件</span>
        <span class="token comment">// 格式[ [bundle.js,{}],[index.html,{}] ]</span>
        <span class="token keyword">let</span> content <span class="token operator">=</span> <span class="token template-string"><span class="token string">`## 文件名 资源大小 \r\n `</span></span>
        Object<span class="token punctuation">.</span><span class="token function">entries</span><span class="token punctuation">(</span>assets<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">[</span>filename<span class="token punctuation">,</span>statObj<span class="token punctuation">]</span></span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          content <span class="token operator">+=</span> <span class="token template-string"><span class="token string">`- </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>filename<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">  </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>statObj<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> \r\n`</span></span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token comment">// 资源对象 下面的就是打包出来的文件</span>
        assets<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>filename<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> content
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">return</span> content<span class="token punctuation">.</span>length
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FileListPlugin
</code></pre></div><ul><li>InlineSourcePlugin 把外链的标签 变成内联的标签</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 把外链的标签 变成内联的标签</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'html-webpack-plugin'</span><span class="token punctuation">)</span>
<span class="token keyword">class</span> <span class="token class-name">InlineSourcePlugin</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">match</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>match <span class="token operator">=</span> match<span class="token punctuation">;</span><span class="token comment">//正则</span>
  <span class="token punctuation">}</span>
  <span class="token function">progressTage</span><span class="token punctuation">(</span><span class="token parameter">tag<span class="token punctuation">,</span>compilation</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 处理某一个数据</span>
    <span class="token keyword">let</span> newTag<span class="token punctuation">,</span>url<span class="token punctuation">;</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">'link'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>href<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      newTag<span class="token operator">=</span> <span class="token punctuation">{</span>
        tagName<span class="token punctuation">:</span><span class="token string">'style'</span>
      <span class="token punctuation">}</span>
      url <span class="token operator">=</span> tag<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>href
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span>tagName <span class="token operator">===</span> <span class="token string">'scfript'</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>reg<span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>tag<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>src<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      newTag<span class="token operator">=</span> <span class="token punctuation">{</span>
        tagName<span class="token punctuation">:</span><span class="token string">'scfript'</span>
      <span class="token punctuation">}</span>
      url <span class="token operator">=</span> tag<span class="token punctuation">.</span>attributes<span class="token punctuation">.</span>src
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">{</span>
      newTag<span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">source</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//文件的内容放到innerHTML属性上面</span>
      <span class="token keyword">delete</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span>url<span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment">// 删除掉原来应生成的资源</span>
      <span class="token keyword">return</span> newTag
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> tag<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token function">progressTages</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment">// 处理引入标签的数据</span>
    <span class="token keyword">let</span> headTags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> bodyTags <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>headTags<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">headTag</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      headTags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">progressTage</span><span class="token punctuation">(</span>headTag<span class="token punctuation">,</span>compilation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    data<span class="token punctuation">.</span>bodyTags<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">bodyTag</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      bodyTags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">progressTage</span><span class="token punctuation">(</span>bodyTag<span class="token punctuation">,</span>compilation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token operator">...</span>data<span class="token punctuation">,</span> headTags<span class="token punctuation">,</span> bodyTags<span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 要通过webpackPlugin来实现这个功能</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>compilation<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'MyPlugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      HtmlWebpackPlugin<span class="token punctuation">.</span><span class="token function">getHooks</span><span class="token punctuation">(</span>compilation<span class="token punctuation">)</span><span class="token punctuation">.</span>alterAssetTagGroups<span class="token punctuation">.</span><span class="token function">tapAsync</span>
      <span class="token punctuation">(</span><span class="token string">'alterPlugin'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">data<span class="token punctuation">,</span>cb</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
        data <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">progressTages</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">cb</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span>data<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>     
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">上次更新: </span> <span class="time">8/10/2020, 12:21:46 AM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/front/phone.html" class="prev">
          移动端
        </a></span> <span class="next"><a href="/front/video.html">
          视频
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.2d5a21ba.js" defer></script><script src="/assets/js/47.e82a83b5.js" defer></script>
  </body>
</html>
